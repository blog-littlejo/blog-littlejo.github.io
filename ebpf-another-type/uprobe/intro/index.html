<!doctype html><html lang=fr dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="fr"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>L’observabilité pour tous les développeurs avec les uProbes &#183; Le blog de Little Jo</title><meta name=title content="L’observabilité pour tous les développeurs avec les uProbes &#183; Le blog de Little Jo"><meta name=description content="Découverte des uProbes et uRetProbes eBPF avec Aya"><meta name=keywords content="Rust,eBPF,aya,uprobe,uretprobe,kprobe,usdt,bpftrace,"><link rel=canonical href=https://blog.littlejo.link/ebpf-another-type/uprobe/intro/><link type=text/css rel=stylesheet href=/css/main.bundle.min.2bef69aa0d5bbd53f1fcc50836e6b87ebca45feb416b22a989d6f651ca847c2782a5a481fe2d49f05ee298ad615a9cb55b9682c0902a34b1f1bcd58d473c4385.css integrity="sha512-K+9pqg1bvVPx/MUINua4frykX+tBayKpidb2UcqEfCeCpaSB/i1J8F7imK1hWpy1W5aCwJAqNLHxvNWNRzxDhQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.98bb8ce8f123e03c4d2171eeec151dd404b5c476beb5ef1068d0e8b1a2afb923065e6552fc14b2d867c85ee4bd8529a43193f729f874d3908517ba03b5d1cc57.js integrity="sha512-mLuM6PEj4DxNIXHu7BUd1AS1xHa+te8QaNDosaKvuSMGXmVS/BSy2GfIXuS9hSmkMZP3Kfh005CFF7oDtdHMVw==" data-copy=Copier data-copied=Copié></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://blog.littlejo.link/ebpf-another-type/uprobe/intro/"><meta property="og:site_name" content="Le blog de Little Jo"><meta property="og:title" content="L’observabilité pour tous les développeurs avec les uProbes"><meta property="og:description" content="Découverte des uProbes et uRetProbes eBPF avec Aya"><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="ebpf-another-type"><meta property="article:published_time" content="2025-09-08T10:05:00+02:00"><meta property="article:modified_time" content="2025-09-08T10:05:00+02:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="EBPF"><meta property="article:tag" content="Aya"><meta property="article:tag" content="Uprobe"><meta property="article:tag" content="Uretprobe"><meta property="article:tag" content="Kprobe"><meta property="og:image" content="https://blog.littlejo.link/ebpf-another-type/uprobe/intro/featured.webp"><meta property="og:see_also" content="https://blog.littlejo.link/ebpf-another-type/uprobe/example-1-tr/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.littlejo.link/ebpf-another-type/uprobe/intro/featured.webp"><meta name=twitter:title content="L’observabilité pour tous les développeurs avec les uProbes"><meta name=twitter:description content="Découverte des uProbes et uRetProbes eBPF avec Aya"><meta name=twitter:image content="https://blog.littlejo.link/ebpf-another-type/uprobe/intro/featured.webp"><meta property="og:image" content="https://blog.littlejo.link/ebpf-another-type/uprobe/intro/featured.webp"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Ebpf-Another-Types","name":"L’observabilité pour tous les développeurs avec les uProbes","headline":"L’observabilité pour tous les développeurs avec les uProbes","description":"Découverte des uProbes et uRetProbes eBPF avec Aya","abstract":"Découverte des uProbes et uRetProbes eBPF avec Aya","inLanguage":"fr","url":"https:\/\/blog.littlejo.link\/ebpf-another-type\/uprobe\/intro\/","author":{"@type":"Person","name":"Joseph Ligier"},"copyrightYear":"2025","dateCreated":"2025-09-08T10:05:00\u002b02:00","datePublished":"2025-09-08T10:05:00\u002b02:00","dateModified":"2025-09-08T10:05:00\u002b02:00","keywords":["Rust","eBPF","aya","uprobe","uretprobe","kprobe","usdt","bpftrace"],"mainEntityOfPage":"true","wordCount":"2075"}]</script><meta name=author content="Joseph Ligier"><link href=https://bsky.app/profile/littlejo.bsky.social rel=me><link href=https://www.linkedin.com/in/joseph-ligier-4b86632 rel=me><link href=https://dev.to/littlejo rel=me><link href=https://medium.com/@littel.jo rel=me><link href=https://github.com/littlejo rel=me><link href=https://ko-fi.com/littlejo rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script data-goatcounter=https://littlejo-prd.goatcounter.com/count async src=/js/count.js></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Aller au contenu</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Le blog de Little Jo</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/categories/introduction/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Introduction>Blog</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="L’observabilité pour tous les développeurs avec les uProbes">FR</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/ebpf-another-type/uprobe/intro/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="L’observabilité pour tous les développeurs avec les uProbes">FR</p></a><a href=/en/ebpf-another-type/uprobe/intro/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Observability for All Developers with uProbes">EN</p></a></div></div></div></div><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Rechercher (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="L’observabilité pour tous les développeurs avec les uProbes">FR</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/ebpf-another-type/uprobe/intro/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="L’observabilité pour tous les développeurs avec les uProbes">FR</p></a><a href=/en/ebpf-another-type/uprobe/intro/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Observability for All Developers with uProbes">EN</p></a></div></div></div></div><button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Rechercher (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/categories/introduction/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Introduction>Blog</p></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/ebpf-another-type/uprobe/intro/featured_hu_d1e792c07a8e6c74.webp alt="Background Image" class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=background-blur data-image-id=background-image data-image-url=/ebpf-another-type/uprobe/intro/featured.webp></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Le blog de Little Jo</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/ebpf-another-type/>Ebpf-Another-Types</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/ebpf-another-type/uprobe/intro/>L’observabilité pour tous les développeurs avec les uProbes</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">L’observabilité pour tous les développeurs avec les uProbes</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-09-08T10:05:00+02:00>8 septembre 2025</time><span class="px-2 text-primary-500">&#183;</span><span>2075 mots</span><span class="px-2 text-primary-500">&#183;</span><span title="Temps de lecture">10 mins</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js integrity="sha512-mBTe6WFNMq61YjnRGO3+IKzWIxQk+bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Activer le mode zen" data-title-i18n-disable="Activer le mode zen" data-title-i18n-enable="Désactiver le mode zen"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Joseph Ligier" src=/img/littlejo_hu_4250d52962eec5b0.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Auteur</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Joseph Ligier</div><div class="text-sm text-neutral-700 dark:text-neutral-400">CNCF ambassador | Kubestronaut 🐝</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://bsky.app/profile/littlejo.bsky.social target=_blank aria-label=Bluesky rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/joseph-ligier-4b86632 target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://dev.to/littlejo target=_blank aria-label=Dev rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88.0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59.0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21.0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44.0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44.0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://medium.com/@littel.jo target=_blank aria-label=Medium rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M180.5 74.262C80.813 74.262.0 155.633.0 256S80.819 437.738 180.5 437.738 361 356.373 361 256 280.191 74.262 180.5 74.262zm288.25 10.646c-49.845.0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559C559 161.5 518.6 84.908 468.752 84.908zm139.506 17.821c-17.526.0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/littlejo target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://ko-fi.com/littlejo target=_blank aria-label=Ko-Fi rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg width="211.67mm" height="211.67mm" viewBox="0 0 211.67 211.67"><defs><clipPath id="clipPath25"><path d="m0 6e2h1654.8V0H0z" fill="currentColor"/></clipPath></defs><g transform="translate(-3.0786 -29.59)"><g transform="matrix(.35278 0 0 -.35278 3.0785 241.26)"><g clip-path="url(#clipPath25)"><g transform="translate(600 300)"><path d="m-3e2 3e2c-165.69.0-3e2-134.31-3e2-3e2s134.31-3e2 3e2-3e2C-134.32-3e2.0-165.69.0.0s-134.32 3e2-3e2 3e2zm-188.93-166.99h329.58c23.223.0 46.032-6.8325 65.073-20.125 18.412-12.856 36.378-33.646 42.697-67.02 14.674-77.514-43.568-135.76-126.12-131.18.438-21.268-3.8105-59.422-44.878-69.696-3.282-.821-6.6604-1.186-10.044-1.207-72.13-.448-222.53-.88916-222.53-.88916s-46.066-.01555-49.176 45.962c-1.023 77.88-.48339 223.69-.48339 223.69s-.02651 2.9267-.02051 3.6577c.043 5.607 4.4359 16.8 15.901 16.8zm312.71-55.573v-107.8s14.302-1.6507 31.907.54932c20.356 6.6 39.06 20.901 39.06 57.199.0 14.85-5.2614 25.601-11.837 33.239-9.341 10.848-23.152 16.809-37.469 16.809h-21.661z" fill="currentColor"/></g><g transform="translate(256.61 203.37)"><path d="m0 0c3.585-1.806 5.876.437 5.876.437s52.457 47.878 76.089 75.452c21.018 24.667 22.389 66.234-13.708 81.766-36.096 15.532-65.795-18.272-65.795-18.272-25.755 28.326-64.734 26.891-82.763 7.721-18.027-19.169-11.732-52.072 1.717-70.383 12.626-17.19 68.119-66.65 76.529-75.015.0.0.614-.641 2.055-1.706" fill="currentColor"/></g></g></g></g></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Sommaire</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#quest-ce-quune-uretprobe->Qu&rsquo;est-ce qu&rsquo;une u•Ret•Probe ?</a><ul><li><a href=#kprobe--la-sonde-pour-le-kernel>kProbe : la sonde pour le <strong>k</strong>ernel</a></li><li><a href=#kretprobe--retour-sur-la-sonde-kernel>kRetProbe : retour sur la sonde <strong>k</strong>ernel</a></li><li><a href=#uprobe--la-sonde-pour-les-utilisateurs>uProbe : la sonde pour les <strong>u</strong>tilisateurs</a></li><li><a href=#uretprobe--retour-sur-la-sonde-utilisateur>uRetProbe : retour sur la sonde <strong>u</strong>tilisateur</a></li><li><a href=#usdt--le-tracepoint-de-lespace-utilisateur>USDT : le <em>tracepoint</em> de l’espace utilisateur</a></li></ul></li><li><a href=#origin-story>Origin story</a><ul><li><a href=#utrace-lancêtre>uTrace l&rsquo;ancêtre</a></li><li><a href=#habemus-uprobe>Habemus uProbe</a></li><li><a href=#uprobe-avec-ebpf>uProbe avec eBPF</a></li></ul></li><li><a href=#quels-projets-utilisent-uretprobe->Quels projets utilisent u•Ret•Probe ?</a><ul><li><a href=#pixie--where-is-my-mind>Pixie : where is my mind?</a></li><li><a href=#parca--lhiver-vient->Parca : l&rsquo;hiver vient !</a></li><li><a href=#inspektor-gadget--hé-là-qui-va-là>Inspektor Gadget : hé là, qui va là?</a></li></ul></li><li><a href=#bonus-track>Bonus Track</a></li><li><a href=#comment-débuter-son-programme-aya->Comment débuter son programme Aya ?</a><ul><li><a href=#cible-pour-attacher-luretprobe>Cible pour attacher l&rsquo;u•Ret•Probe</a></li><li><a href=#nom-de-la-fonction-pour-attacher-luretprobe>Nom de la fonction pour attacher l&rsquo;u•Ret•Probe</a></li><li><a href=#sinitier-à-ebpf-avec-bpftrace>S&rsquo;initier à eBPF avec bpftrace</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Sommaire</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#quest-ce-quune-uretprobe->Qu&rsquo;est-ce qu&rsquo;une u•Ret•Probe ?</a><ul><li><a href=#kprobe--la-sonde-pour-le-kernel>kProbe : la sonde pour le <strong>k</strong>ernel</a></li><li><a href=#kretprobe--retour-sur-la-sonde-kernel>kRetProbe : retour sur la sonde <strong>k</strong>ernel</a></li><li><a href=#uprobe--la-sonde-pour-les-utilisateurs>uProbe : la sonde pour les <strong>u</strong>tilisateurs</a></li><li><a href=#uretprobe--retour-sur-la-sonde-utilisateur>uRetProbe : retour sur la sonde <strong>u</strong>tilisateur</a></li><li><a href=#usdt--le-tracepoint-de-lespace-utilisateur>USDT : le <em>tracepoint</em> de l’espace utilisateur</a></li></ul></li><li><a href=#origin-story>Origin story</a><ul><li><a href=#utrace-lancêtre>uTrace l&rsquo;ancêtre</a></li><li><a href=#habemus-uprobe>Habemus uProbe</a></li><li><a href=#uprobe-avec-ebpf>uProbe avec eBPF</a></li></ul></li><li><a href=#quels-projets-utilisent-uretprobe->Quels projets utilisent u•Ret•Probe ?</a><ul><li><a href=#pixie--where-is-my-mind>Pixie : where is my mind?</a></li><li><a href=#parca--lhiver-vient->Parca : l&rsquo;hiver vient !</a></li><li><a href=#inspektor-gadget--hé-là-qui-va-là>Inspektor Gadget : hé là, qui va là?</a></li></ul></li><li><a href=#bonus-track>Bonus Track</a></li><li><a href=#comment-débuter-son-programme-aya->Comment débuter son programme Aya ?</a><ul><li><a href=#cible-pour-attacher-luretprobe>Cible pour attacher l&rsquo;u•Ret•Probe</a></li><li><a href=#nom-de-la-fonction-pour-attacher-luretprobe>Nom de la fonction pour attacher l&rsquo;u•Ret•Probe</a></li><li><a href=#sinitier-à-ebpf-avec-bpftrace>S&rsquo;initier à eBPF avec bpftrace</a></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const n=.33,s="#TableOfContents",o=".anchor",i='a[href^="#"]',a="li ul",r="active";function c(e,t){const s=window.scrollY+window.innerHeight*t,o=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],n=new Set(o.map(e=>e.getAttribute("href").substring(1)));for(let t=e.length-1;t>=0;t--){const o=e[t].getBoundingClientRect().top+window.scrollY;if(o<=s&&n.has(e[t].id))return e[t].id}return e.find(e=>n.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=c(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(r,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function t(){const t=document.querySelector(s);if(!t)return;const c=!1,l=[...document.querySelectorAll(o)],d=[...t.querySelectorAll(i)];c&&t.querySelectorAll(a).forEach(e=>e.style.display="none");const r={toc:t,anchors:l,links:d,scrollOffset:n,collapseInactive:c};window.addEventListener("scroll",()=>e(r),{passive:!0}),window.addEventListener("hashchange",()=>e(r),{passive:!0}),e(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5" open><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Apprenons uProbe avec eBPF et Aya -
Cet article fait partie d'une série.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Partie 1:
Cet article</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/ebpf-another-type/uprobe/example-1-tr/>Partie 2:
Observons une fonction simple de ton programme avec des uProbes</a></div></details><div class="article-content max-w-prose mb-20"><p>Je débute la programmation en eBPF avec Aya. L’idée de cette série d’articles est d&rsquo;apprendre un nouveau type de programme eBPF et de l&rsquo;expérimenter avec le framework Rust Aya.</p><p>Aujourd&rsquo;hui, nous allons nous plonger dans les <strong>uProbes</strong> et les <strong>uRetProbes</strong> : des programmes eBPF qui sondent les fonctions de l&rsquo;espace utilisateur sans laisser de trace.</p><p>Vous allez voir que cela peut être très intéressant pour du profilage, du <em>debug</em> ou même de la rétro-ingénierie.</p><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-tip"><span class="relative block icon"><svg width="35.895355" height="36.001198" viewBox="0 0 35.895355 36.001198" fill="none" id="svg13"><path fill-rule="evenodd" clip-rule="evenodd" d="m23.6364.10692772c.484.244422.6756.829517.4279 1.30684198-.489.9425-.7536 2.29434-.8548 3.68384-.0998 1.37144-.0333 2.66933.0689 3.4332.0712.53167-.308 1.01948-.847 1.08955s-1.0337-.30413-1.1048-.83581c-.1203-.89834-.1899-2.32813-.0808-3.82659.1078-1.4804.3972-3.14069 1.0658-4.42931998.2477-.4773282.8408-.666135 1.3248-.421712z" fill="#1a1a1a" id="path1"/><path d="m17.9279 15.4786c.591-2.7701-5.4162-3.2222-8.49374-3.1019-12.13253.2574-7.06117 7.5956-.344 8.4137 2.76434.3367 8.09894-1.8492 8.83774-5.3118z" fill="currentColor" id="path2"/><path d="m3.00152 13.9149c.34054-.2771.78266-.5279 1.33721-.743l.17291.5359.88014 1.0998 1.28927 1.153.9905-.145 4.95105-.5064 5.2045.5492c-.1637.515-.4287.9991-.7694 1.4477C15.5173 17.0017 11.9211 16.9114 9.96784 16.9078 9.44518 17.5136 9.25598 19.5736 9.2151 20.8038 9.17288 20.7999 9.1312 20.7954 9.09009 20.7904 8.54185 20.7236 8.00457 20.6134 7.48672 20.4672 7.43882 19.5053 7.77515 18.1299 8.01989 17.3664 6.48879 17.4486 4.86925 18.1947 3.97602 18.7145 3.56434 18.3884 3.20739 18.0402 2.91797 17.6812l1.98456-1.0757C4.59621 16.4519 3.62819 14.9452 3.00152 13.9149z" fill="currentColor" id="path3"/><path d="M16.8986 18.8203l1.7838 1.1899-8.0602 11.7636-1.9367-1.2919-1.48753-2.1642-.74485-3.5732 1.33387-3.1389 3.20141.9634z" fill="currentColor" id="path4"/><path fill-rule="evenodd" clip-rule="evenodd" d="M15.2758 11.0042c2.3911-5.0861403 8.2076-3.8391103 10.9546-2.0068003L18.6815 20.0147 17.8151 19.4368c-1.1 1.2586-3.3469 2.2113-4.3328 2.5303.1001 1.4145 1.3034 2.5052 1.8925 2.8737l-2.4801 3.6196c-2.89488-1.931-3.74047-4.6925-3.80141-5.8318l-1.0745-.0575c-1.89715 4.2428 1.07775 7.5309 2.91251 8.7548L7.72792 36.0012 8.28497 31.6116c-3.61109-3.0533-2.96504-7.6667-2.19063-9.5917C3.60654 21.5324-.71116398 17.9714.09996132 14.9451 1.51225 9.6757097 10.7796 9.7630597 15.2758 11.0042zm2.6538 4.4605c.5621-2.7545-5.4263-3.2044-8.49737-3.0844-1.95229.0414-3.45912.2662-4.5853.6176.50118 1.5357 1.66332 2.2994 2.22769 2.4976 3.56078-.7988 8.18428-.4303 10.85498-.0308zM17.705 16.192c-1.8625-.2387-4.6377-.3002-6.0775-.2966-1.95525 1.3169-2.20603 3.5377-2.03968 4.9319 2.64838.0449 6.94048-1.776 8.11718-4.6353zm-9.01016 4.5464c-.35729-2.0196.79278-3.9252 1.49856-4.7008-3.62095.1363-5.90362 1.15-7.01878 1.9457 1.19325 1.2879 3.24214 2.3888 5.52022 2.7551zM2.5405 17.15c.89512-.5396 2.4988-1.0361 3.3714-1.2581-1.26155-.9307-1.8124-1.9023-2.00718-2.5311-1.97331.9358-2.197 2.4008-1.36422 3.7892z" fill="#1a1a1a" id="path5"/><path fill-rule="evenodd" clip-rule="evenodd" d="m35.5569 8.0548297c-.4102-.35197-1.0318-.30931-1.3885.09529-.7042.79888-1.8771 1.54484-3.1462 2.1552803-1.2527.6024-2.4981 1.0253-3.2547 1.2163-.5265.1329-.844.6619-.7091 1.1814.1349.5195.6711.8329 1.1977.6999.8897-.2246 2.2604-.6937 3.6291-1.352 1.3521-.6503 2.8058-1.534 3.7687-2.6262703.3566-.4046.3132-1.01792-.097-1.3699z" fill="#1a1a1a" id="path6"/><path d="m23.2275 19.0151c2.385-1.5734 5.0488 3.7584 6.0825 6.621 4.2791 11.2045-4.5124 9.2957-7.785 3.4503-1.3468-2.4055-1.2788-8.1045 1.7025-10.0713z" fill="currentColor" id="path7"/><path d="m30.2594 32.1c.1337-.4151.2048-.9133.2005-1.5012L29.8914 30.6402 28.529 30.2441 26.9642 29.4933 26.7315 28.5324l-1.3687-4.7219L22.9067 19.25c-.4233.3418-.7798.7648-1.0748 1.2439.8604 1.297 2.2853 4.556 3.0167 6.343-.3751.7043-2.242 1.6452-3.3838 2.1411.0194.0372.0392.0737.0592.1095.2671.477.571.9279.9015 1.3475.9225-.3145 2.0908-1.135 2.7176-1.6436.4933 1.4325.3951 3.1933.2391 4.2049.4601.2554.9206.4525 1.3661.5837l.2722-2.2179c.2586.2232 2.0364.548 3.2389.7379z" fill="currentColor" id="path8"/><path d="m20.4651 21.1977-1.7838-1.1899-8.0602 11.7636 1.9367 1.2919 2.5898.5554 3.6382-.6495 2.4552-2.391-2.0992-2.5722z" fill="currentColor" id="path9"/><path fill-rule="evenodd" clip-rule="evenodd" d="M28.4238 19.774C32.3164 15.6893 28.976 10.8284 26.229 8.9960897L18.6802 20.0134l.8664.578c-.7738 1.4761-.8325 3.8884-.7651 4.9099-1.3678.4355-2.8419-.2597-3.4081-.6618l-2.48 3.6196c2.8948 1.931 5.8072 1.6761 6.9015 1.3073l.4544.9624c-3.2834 3.3181-7.4845 1.8196-9.3193.5958l-3.20344 4.6753 3.92084-2.1458c4.2173 2.1685 8.3155-.1422 9.8375-1.5687 1.3855 2.0962 6.3437 4.7225 8.8878 2.8521 4.4296-3.2567.8939-11.7094-1.9489-15.3635zm-5.1841-.7677c2.3812-1.5411 5.036 3.7742 6.0675 6.6308.6886 1.8029 1.0387 3.2663 1.1278 4.4284-1.6311.1134-2.7824-.666-3.1791-1.1089-.5757-3.5579-2.6452-7.6538-4.0162-9.9503zm-.6003.4767c.9185 1.6163 2.0106 4.1343 2.5437 5.4541-.51 2.2809-2.5052 3.3381-3.8784 3.7053-1.0291-2.4081-.916-7.0166 1.3347-9.1594zm-.9184 9.9439c2.0327-.4255 3.3963-2.1886 3.8628-3.1238 1.2211 3.3661 1.1184 5.8339.7856 7.1514-1.656-.6126-3.4549-2.0783-4.6484-4.0276zm5.6684 4.2977c.174-1.0207.0433-2.674-.073-3.5557 1.3454.8082 2.4645.9505 3.1284.8946-.1447 2.1554-1.4393 2.9062-3.0554 2.6611z" fill="#1a1a1a" id="path10"/></svg>
</span></span><span class=dark:text-neutral-300>Si tu ne connais pas eBPF, je te conseille de lire les deux premières parties de ma série <a href=https://medium.com/@littel.jo/sinitier-%C3%A0-ebpf-avec-aya-c9d570560261 target=_blank>S’initier à eBPF avec Aya</a>. Cela couvre les bases et t&rsquo;aidera pour la suite de l&rsquo;article.</span></div><hr><h2 class="relative group">Qu&rsquo;est-ce qu&rsquo;une u•Ret•Probe ?<div id=quest-ce-quune-uretprobe- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#quest-ce-quune-uretprobe- aria-label=Ancre>#</a></span></h2><p>En anglais, une <em>probe</em> peut se traduire par une sonde pour examiner ou explorer quelque chose. En eBPF, il y en a de plusieurs types : <em>kProbe</em>, <em>kRetProbe</em>, <em>uProbe</em>, <em>uRetProbe</em> et <em>USDT</em>.</p><h3 class="relative group">kProbe : la sonde pour le <strong>k</strong>ernel<div id=kprobe--la-sonde-pour-le-kernel class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#kprobe--la-sonde-pour-le-kernel aria-label=Ancre>#</a></span></h3><p>Si tu consultes la <a href=https://docs.ebpf.io/linux/program-type/ target=_blank>documentation d&rsquo;eBPF</a>, il n&rsquo;y a pas de section consacrée aux programmes de type uProbe ou uRetProbe. Mais il y en a une dédiée à la <a href=https://docs.ebpf.io/linux/program-type/BPF_PROG_TYPE_KPROBE/ target=_blank>kProbe</a> :</p><p><a href=https://docs.ebpf.io/linux/program-type/BPF_PROG_TYPE_KPROBE/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Kprobe documentation" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-doc.webp></figure></a></p><p>La kProbe a pour but d&rsquo;observer des fonctions du kernel Linux. Elle peut être considérée comme la probe parente. Toutes les autres probes sont en fait le même type de programme <code>BPF_PROG_TYPE_KPROBE</code> mais c&rsquo;est juste le point d&rsquo;attache qui va déterminer comment le programme est exécuté.</p><h3 class="relative group">kRetProbe : retour sur la sonde <strong>k</strong>ernel<div id=kretprobe--retour-sur-la-sonde-kernel class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#kretprobe--retour-sur-la-sonde-kernel aria-label=Ancre>#</a></span></h3><p>La <strong>kRet</strong>Probe est simplement dédiée à l&rsquo;observation du <strong>ret</strong>our des fonctions du <strong>k</strong>ernel Linux. Cette sonde permet ainsi de vérifier si l&rsquo;appel de la fonction s&rsquo;est bien terminé.</p><p>Nous avons vu brièvement kProbe et kRetProbe qui pourraient faire l&rsquo;objet d&rsquo;autres articles. Parlons maintenant des <em>probes</em> qui nous intéressent aujourd&rsquo;hui : uProbe et uRetProbe.</p><h3 class="relative group">uProbe : la sonde pour les <strong>u</strong>tilisateurs<div id=uprobe--la-sonde-pour-les-utilisateurs class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#uprobe--la-sonde-pour-les-utilisateurs aria-label=Ancre>#</a></span></h3><p>Contrairement aux <strong>k</strong>Probes qui sont dédiées à observer les fonctions du <strong>k</strong>ernel Linux, les <strong>u</strong>Probes sont dédiées aux fonctions de l&rsquo;espace utilisateur : <em>User-space Probes</em>. Par exemple, on pourrait s&rsquo;en servir pour compter le nombre d&rsquo;appels aux fonctions <code>malloc</code> et <code>free</code> dans un programme C.</p><p>uProbe permet également de récupérer le contenu des arguments de la fonction observée. Ainsi on pourrait regarder la quantité de mémoire allouée à chaque <code>malloc</code> ou vérifier que <code>free</code> libère réellement des bons pointeurs.</p><p>Ainsi les uProbes pourrait s&rsquo;intégrer à une CI pour automatiser des vérifications de sécurité, faciliter le debogage ou aider au diagnostic mémoire.</p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="128" height="128" viewBox="0 0 48 48"><title>Free Medical icons</title><path d="M30.88 31.45A2 2 0 0129.46 28l2.81-2.84A2 2 0 1135.12 28L32.3 30.86a2 2 0 01-1.42.59z" fill="currentColor"/><path d="M19.51 20.19a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 012.84 2.81L20.93 19.6a2 2 0 01-1.42.59z" fill="currentColor"/><path d="M25.2 25.82a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 112.84 2.81l-2.81 2.84A2 2 0 0125.2 25.82z" fill="currentColor"/><path d="M13.86 14.54a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 112.84 2.81l-2.81 2.84a2 2 0 01-1.42.6z" fill="currentColor"/><path d="M41.9 47.27A5.46 5.46.0 0138 45.68l-4.79-4.75-2.3-.14a8 8 0 01-5.14-2.3L3.27 16.12A9 9 0 019.56.73h0a8.94 8.94.0 016.33 2.61L38.46 25.7a8 8 0 012.35 5.11L41 33.12l4.79 4.75a5.5 5.5.0 01-3.84 9.41h0zM9.6 4.73h0a5 5 0 00-3.49 8.55h0l22.5 22.37a4 4 0 002.57 1.15L35 37l5.86 5.81a1.49 1.49.0 001.05.43h0a1.5 1.5.0 001-2.57L37.09 34.9l-.27-3.8a4 4 0 00-1.17-2.56L13.12 6.17A5 5 0 009.6 4.73z" fill="currentColor"/><rect width="48" height="48" fill="none"/></svg>
</span></span><span class=dark:text-neutral-300>Ça peut paraître paradoxal de vouloir tracer un code utilisateur depuis l&rsquo;espace noyau. Cependant cela a le mérite d&rsquo;être non intrusif car il n&rsquo;y a pas besoin de modifier le programme.</span></div><h3 class="relative group">uRetProbe : retour sur la sonde <strong>u</strong>tilisateur<div id=uretprobe--retour-sur-la-sonde-utilisateur class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#uretprobe--retour-sur-la-sonde-utilisateur aria-label=Ancre>#</a></span></h3><p>De la même manière que la kRetProbe, u<strong>Ret</strong>Probe a pour but d&rsquo;étudier le <strong>ret</strong>our de la fonction cible de l&rsquo;espace utilisateur : <em>User-space Return Probe</em>.
On peut donc découvrir la valeur que retourne la fonction. Cela permet ainsi de debugger ou d&rsquo;observer le comportement final de la fonction.</p><p>Mais il y a un autre intérêt : en combinant les temps de l&rsquo;uProbe et de l&rsquo;uRetProbe, on peut récupérer la durée que met une fonction à s&rsquo;exécuter assez facilement. Il est ainsi possible de profiler une fonction de son programme.</p><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-tip"><span class="relative block icon"><svg width="800" height="800" viewBox="0 0 32 32"><title>file_type_sql</title><path d="M8.562 15.256A21.159 21.159.0 0016 16.449a21.159 21.159.0 007.438-1.194c1.864-.727 2.525-1.535 2.525-2V9.7a10.357 10.357.0 01-2.084 1.076A22.293 22.293.0 0116 12.078a22.36 22.36.0 01-7.879-1.3A10.28 10.28.0 016.037 9.7v3.55c0 .474.663 1.278 2.525 2.006z" style="fill:currentColor"/><path d="M8.562 21.961a15.611 15.611.0 002.6.741A24.9 24.9.0 0016 23.155a24.9 24.9.0 004.838-.452 15.614 15.614.0 002.6-.741c1.864-.727 2.525-1.535 2.525-2v-3.39a10.706 10.706.0 01-1.692.825A23.49 23.49.0 0116 18.74a23.49 23.49.0 01-8.271-1.348 10.829 10.829.0 01-1.692-.825V19.96C6.037 20.426 6.7 21.231 8.562 21.961z" style="fill:currentColor"/><path d="M16 30c5.5.0 9.963-1.744 9.963-3.894V23.269a10.5 10.5.0 01-1.535.762l-.157.063A23.487 23.487.0 0116 25.445a23.422 23.422.0 01-8.271-1.351c-.054-.02-.106-.043-.157-.063a10.5 10.5.0 01-1.535-.762v2.837C6.037 28.256 10.5 30 16 30z" style="fill:currentColor"/><ellipse cx="16" cy="5.894" rx="9.963" ry="3.894" style="fill:currentColor"/></svg>
</span></span><span class=dark:text-neutral-300>On pourrait, par exemple, l&rsquo;utiliser pour des requêtes SQL où on identifierait les requêtes les plus longues.</span></div><p>Les uRetProbe et uProbes peuvent être utilisées pour débugger et comprendre un programme dont tu n&rsquo;as pas le code source. Ça peut donc être un bel outil de rétro-ingénierie (<em>reverse engineering</em>).</p><p>Par contre, elles sont limitées aux programmes dont le langage est compilé : C/C++, Rust, Go, etc. Si on a un programme développé avec un autre langage, <em>USDT</em> pourrait vous convenir. Parlons-en.</p><h3 class="relative group">USDT : le <em>tracepoint</em> de l&rsquo;espace utilisateur<div id=usdt--le-tracepoint-de-lespace-utilisateur class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#usdt--le-tracepoint-de-lespace-utilisateur aria-label=Ancre>#</a></span></h3><p><em>USDT</em> veut dire <strong>U</strong>ser <strong>S</strong>tatically-<strong>D</strong>efined <strong>T</strong>racing. Comme son nom l&rsquo;indique, elle est également dédiée aux programmes de l&rsquo;espace utilisateur mais il faut rajouter dans le code des sondes <em>usdt</em> pour les utiliser. <em>USDT</em> est, en fait, dérivée de l&rsquo;uProbe.</p><p>Par contre, elle est beaucoup plus précise que l&rsquo;uProbe. En effet, la sonde uProbe est cantonnée au début de fonction alors que la sonde <em>usdt</em> peut être mise à n&rsquo;importe quel endroit dans le code.</p><p>Voici un <a href=https://github.com/josefbacik/pyusdt/blob/main/src/benchmark.py target=_blank>exemple</a> de code Python :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=nf>benchmark_module</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>loop</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>pyusdt</span><span class=o>.</span><span class=n>trace_start_loop</span><span class=p>(</span><span class=n>loop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>calculate_pi</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pyusdt</span><span class=o>.</span><span class=n>trace_stop_loop</span><span class=p>(</span><span class=n>loop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>loop</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></div><p>Avec ce code, on peut avoir la durée pour calculer les 1000 décimales de π.</p><div class="flex px-4 py-3 rounded-md
alert-warning"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-warning"><span class="relative block icon"><!doctype html><svg height="800" width="800" id="_x32_" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><style>.st0{fill:currentColor}</style><g><path class="st0" d="M485.235 281.91l-44.273-25.356-65.345 8.26c-1.168-4.886-2.55-9.608-4.173-14.099l46.634-18.049 27.349-47.596-2.954-23.279c18.874-15.396 31.677-45.767 16.762-78.388-18.024-39.422-54.964-47.27-54.964-47.27l2.07 70.755-56.364-28.259c-5.169 72.541 40.787 95.467 69.029 93.252l1.031 8.098-18.917 32.912-40.512 15.688c-13.516-20.728-36.811-43.303-38.589-58.287 5.144-4.336 8.407-10.82 8.407-18.075.0-13.051-10.578-23.631-23.63-23.631s-23.64 10.58-23.64 23.631c0 6.475 2.611 12.34 6.818 16.607-7.007 10.501-6.414 17.723-33.978 17.723-27.555.0-26.97-7.222-33.977-17.723 4.216-4.267 6.826-10.132 6.826-16.607.0-13.051-10.588-23.631-23.648-23.631-13.052.0-23.622 10.58-23.622 23.631.0 7.256 3.263 13.739 8.406 18.075-1.777 14.984-25.073 37.558-38.588 58.287l-40.521-15.688-18.9-32.912 1.022-8.098c28.242 2.215 74.198-20.711 69.021-93.252l-56.364 28.259 2.078-70.755s-36.948 7.849-54.963 47.27c-14.924 32.62-2.113 62.992 16.752 78.388l-2.954 23.279 27.348 47.596 46.635 18.049c-1.606 4.491-2.998 9.213-4.174 14.099l-65.336-8.26L26.756 281.91.0 327.935l15.353 10.158 28.671-37.773 32.088-18.376 56.596 7.162c-.293 4.259-.404 8.518-.301 12.786l-40.71 13.567L52.216 362.84l-6.414 60.279 18.195 2.868 11.42-52.628 30.672-36.811 29.478-9.832c2.216 9.223 5.634 17.929 10.45 25.64l-27.624 19.174-11.867 51.546 15.903 52.791 17.774-4.808-8.569-49.176 9.247-36.064 20.574-14.28c34.467 33.874 81.737 33.643 94.539 33.643 12.812.0 60.073.231 94.549-33.643l20.574 14.28 9.239 36.064-8.56 49.176 17.774 4.808 15.903-52.791-11.876-51.546-27.632-19.174c4.826-7.711 8.244-16.418 10.458-25.64l29.479 9.832 30.68 36.811 11.412 52.628 18.195-2.868-6.414-60.279-39.482-47.381-40.71-13.567c.112-4.267-.009-8.526-.292-12.786l56.595-7.162 32.081 18.376 28.67 37.773L512 327.935 485.235 281.91z"/></g></svg>
</span></span><span class=dark:text-neutral-300>Au moment de l&rsquo;écriture, <a href=https://github.com/aya-rs/aya/pull/329 target=_blank>le framework Aya ne gère pas encore</a> les programmes de type USDT.</span></div><p>Nous allons maintenant nous consacrer pour la suite de l&rsquo;article aux uProbes et uRetProbes. Parlons d&rsquo;abord un peu de leur histoire.</p><hr><h2 class="relative group">Origin story<div id=origin-story class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#origin-story aria-label=Ancre>#</a></span></h2><h3 class="relative group">uTrace l&rsquo;ancêtre<div id=utrace-lancêtre class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#utrace-lanc%c3%aatre aria-label=Ancre>#</a></span></h3><p>Vouloir tracer des fonctions de l&rsquo;espace utilisateur depuis le noyau Linux ne date pas de l&rsquo;introduction d&rsquo;eBPF. Par exemple, une (première ?) tentative est apparue en 2007 avec les <strong>uTraces</strong> :</p><p><a href=https://lwn.net/Articles/224772/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Introducing utrace" src=https://blog.littlejo.link/assets/screenshot/uprobe/utrace.webp></figure></a></p><p>Mais elles n&rsquo;ont jamais été incluses dans le code principal du fait d&rsquo;opposition de certains mainteneurs.</p><h3 class="relative group">Habemus uProbe<div id=habemus-uprobe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#habemus-uprobe aria-label=Ancre>#</a></span></h3><p>Il a fallu attendre 2012 pour que le consensus finisse par arriver et les uProbes ont été introduites lors de la version 3.5 du noyau Linux :</p><p><a href=https://lwn.net/Articles/499190/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Introducing uprobe" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-history.webp></figure></a></p><p>À l&rsquo;époque, les uProbes étaient limités par rapport à celles qu&rsquo;on connaît aujourd&rsquo;hui.</p><p>Ainsi, elles ont ensuite été améliorées avec la version 3.14 (sortie en 2014, la même année que l&rsquo;introduction d&rsquo;eBPF) :</p><p><a href=https://lwn.net/Articles/577142/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Patching uprobe" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-history-2.webp></figure></a></p><p>Ce patch a permis de récupérer un nombre plus important de données comme la valeur de retour d&rsquo;une fonction.</p><p>Les uProbes sont alors devenues pleinement exploitables alors qu&rsquo;eBPF n&rsquo;était pas encore sortie. Voyons quand son intégration s&rsquo;est faite.</p><h3 class="relative group">uProbe avec eBPF<div id=uprobe-avec-ebpf class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#uprobe-avec-ebpf aria-label=Ancre>#</a></span></h3><p>D&rsquo;après la documentation d&rsquo;eBPF, kProbe est apparue en 2015 dans la version 4.1 du noyau Linux. C&rsquo;est Alexei Starovoitov, l&rsquo;un des créateurs d&rsquo;eBPF, qui l&rsquo;a initié :</p><p><a href=https://github.com/torvalds/linux/commit/2541517c32be2531e0da59dfd7efc1ce844644f5 target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Patching kprobe eBPF" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-history-3.webp></figure></a></p><p>Comme une uProbe est une kProbe avec un point d&rsquo;attache différent, on pouvait commencer à développer des uProbes avec eBPF à partir du 2 avril 2015.</p><p>Cependant, il fallait encore attendre que les frameworks eBPF de l&rsquo;époque puissent le gérer.</p><p>Ainsi on pouvait déjà l&rsquo;utiliser <a href=https://github.com/iovisor/bcc/commit/948cefe14ba1f18aa49732c5f2f65837c79572be target=_blank>en 2016 avec BCC</a> comme l&rsquo;atteste le tutoriel de Brendan Gregg :</p><p><a href=https://www.brendangregg.com/blog/2016-02-08/linux-ebpf-bcc-uprobes.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="uprobe bcc eBPF tutorial" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-history-4.webp></figure></a></p><p>On peut voir également son <em>issue</em> sur GitHub datant d&rsquo;octobre 2015 :
<a href=https://github.com/iovisor/bcc/issues/273 target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="uprobe bcc issue" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-issue.webp></figure></a></p><p>Pour finir, voici une petite frise chronologique de l&rsquo;histoire des uProbes :</p><p><figure><img class="my-0 rounded-md" loading=lazy alt="uProbe history" src=https://blog.littlejo.link/assets/svg/uprobe/history.svg></figure></p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="128" height="128" viewBox="0 0 48 48"><title>Free Medical icons</title><path d="M30.88 31.45A2 2 0 0129.46 28l2.81-2.84A2 2 0 1135.12 28L32.3 30.86a2 2 0 01-1.42.59z" fill="currentColor"/><path d="M19.51 20.19a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 012.84 2.81L20.93 19.6a2 2 0 01-1.42.59z" fill="currentColor"/><path d="M25.2 25.82a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 112.84 2.81l-2.81 2.84A2 2 0 0125.2 25.82z" fill="currentColor"/><path d="M13.86 14.54a2 2 0 01-1.42-3.41l2.81-2.84a2 2 0 112.84 2.81l-2.81 2.84a2 2 0 01-1.42.6z" fill="currentColor"/><path d="M41.9 47.27A5.46 5.46.0 0138 45.68l-4.79-4.75-2.3-.14a8 8 0 01-5.14-2.3L3.27 16.12A9 9 0 019.56.73h0a8.94 8.94.0 016.33 2.61L38.46 25.7a8 8 0 012.35 5.11L41 33.12l4.79 4.75a5.5 5.5.0 01-3.84 9.41h0zM9.6 4.73h0a5 5 0 00-3.49 8.55h0l22.5 22.37a4 4 0 002.57 1.15L35 37l5.86 5.81a1.49 1.49.0 001.05.43h0a1.5 1.5.0 001-2.57L37.09 34.9l-.27-3.8a4 4 0 00-1.17-2.56L13.12 6.17A5 5 0 009.6 4.73z" fill="currentColor"/><rect width="48" height="48" fill="none"/></svg>
</span></span><span class=dark:text-neutral-300>Les uRetProbes ont été introduites de façon conjointe aux uProbes.</span></div><p>Maintenant qu&rsquo;uProbe a plus de 10 ans d&rsquo;existence, on peut se poser une question bien légitime : est-elle encore utilisée et par quel projet ?</p><hr><h2 class="relative group">Quels projets utilisent u•Ret•Probe ?<div id=quels-projets-utilisent-uretprobe- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#quels-projets-utilisent-uretprobe- aria-label=Ancre>#</a></span></h2><p>Pour défier le lieu commun : &ldquo;eBPF c&rsquo;est utilisé que par 3 grosses boîtes&rdquo;, j&rsquo;ai fait une petite recherche des outils qui utilisaient réellement les uProbes et que donc vous l&rsquo;utilisiez peut-être sans le savoir&mldr;</p><h3 class="relative group">Pixie : where is my mind?<div id=pixie--where-is-my-mind class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#pixie--where-is-my-mind aria-label=Ancre>#</a></span></h3><p>Le projet <a href=https://github.com/pixie-io/pixie target=_blank>Pixie</a> utilise uProbe notamment pour tracer les connexions TLS :</p><p><figure><img class="my-0 rounded-md" loading=lazy alt="uProbe Pixie" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-pixie.webp></figure></p><p>D&rsquo;ailleurs il y a un article de Douglas Mendez pour <a href=https://douglasmakey.medium.com/uprobes-siblings-capturing-https-traffic-a-rust-and-ebpf-odyssey-b2d7d8ad1ff2 target=_blank>capturer le traffic HTTPs avec Aya</a>.</p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg width="800" height="800" viewBox="0 0 16 16" fill="none"><path d="M2.687 3.21l5.062 4.117c-.477.099-.837.53-.837 1.045.0.133.024.26.067.377L1.706 4.462a.81.81.0 01-.124-1.126.776.776.0 011.105-.126z" fill="currentColor"/><path d="M7.482 9.322 1.06 10.808a.786.786.0 01-.94-.603.801.801.0 01.592-.958L7.095 7.77a1.076 1.076.0 00-.183.602c0 .414.232.773.57.95z" fill="currentColor"/><path d="M8.429 9.327l-2.905 6.12a.78.78.0 01-1.05.373.807.807.0 01-.365-1.07l2.86-6.028c.143.418.533.718.991.718.169.0.328-.04.469-.113z" fill="currentColor"/><path d="M8.97 8.66l2.89 6.09a.807.807.0 01-.365 1.07.78.78.0 01-1.05-.372l-2.89-6.091c.124.053.261.083.405.083.481.0.886-.33 1.01-.78z" fill="currentColor"/><path d="M8.462 9.31a1.07 1.07.0 00.546-.938c0-.233-.073-.448-.198-.624l6.478 1.499a.8.8.0 01.592.958.786.786.0 01-.94.603L8.462 9.31zM8.746.9v6.766a1.037 1.037.0 00-1.572.0V.901c0-.443.352-.801.786-.801.434.0.786.358.786.8z" fill="currentColor"/><path d="M13.234 3.21a.776.776.0 011.104.126.81.81.0 01-.123 1.126L8.94 8.749c.043-.117.067-.244.067-.377.0-.516-.36-.946-.837-1.045l5.063-4.117z" fill="currentColor"/><path d="M7.96 3.302c-2.75.0-4.978 2.27-4.978 5.07s2.229 5.07 4.978 5.07c2.75.0 4.978-2.27 4.978-5.07.0-2.8-2.229-5.07-4.978-5.07zm-6.55 5.07c0-3.684 2.933-6.67 6.55-6.67 3.618.0 6.55 2.986 6.55 6.67.0 3.685-2.932 6.671-6.55 6.671-3.617.0-6.55-2.986-6.55-6.67z" fill="currentColor"/></svg>
</span></span><span class=dark:text-neutral-300>Le Projet Pixie est un outil d&rsquo;observabilité pour les applications qui sont sur Kubernetes.</span></div><h3 class="relative group">Parca : l&rsquo;hiver vient !<div id=parca--lhiver-vient- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#parca--lhiver-vient- aria-label=Ancre>#</a></span></h3><p>Le projet <a href=https://www.parca.dev/ target=_blank>Parca</a> utilise également les uProbes.</p><p><figure><img class="my-0 rounded-md" loading=lazy alt="uProbe Parca" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-parca.webp></figure></p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 32C114.6 32 .0272 125.1.0272 240c0 49.63 21.35 94.98 56.97 130.7-12.5 50.37-54.27 95.27-54.77 95.77-2.25 2.25-2.875 5.734-1.5 8.734C1.979 478.2 4.75 480 8 480c66.25.0 115.1-31.76 140.6-51.39C181.2 440.9 217.6 448 256 448c141.4.0 255.1-93.13 255.1-208S397.4 32 256 32z"/></svg>
</span></span><span class=dark:text-neutral-300>Le projet Parca est un outil de profilage &ldquo;en continue&rdquo; c&rsquo;est à dire de façon systématique.</span></div><h3 class="relative group">Inspektor Gadget : hé là, qui va là?<div id=inspektor-gadget--hé-là-qui-va-là class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#inspektor-gadget--h%c3%a9-l%c3%a0-qui-va-l%c3%a0 aria-label=Ancre>#</a></span></h3><p>Le projet <a href=https://inspektor-gadget.io/ target=_blank>Inspektor Gadget</a> a créé des outils basés sur des uProbes et sur des sondes USDT depuis 2024 :</p><p><a href=https://inspektor-gadget.io/blog/2024/06/supporting-uprobe-based-gadgets-lfx-mentorship-report/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="uProbe Inspektor Gadget" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-inspektor.webp></figure></a></p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg width="800" height="800" viewBox="0 0 16 16" fill="none"><path d="M2.687 3.21l5.062 4.117c-.477.099-.837.53-.837 1.045.0.133.024.26.067.377L1.706 4.462a.81.81.0 01-.124-1.126.776.776.0 011.105-.126z" fill="currentColor"/><path d="M7.482 9.322 1.06 10.808a.786.786.0 01-.94-.603.801.801.0 01.592-.958L7.095 7.77a1.076 1.076.0 00-.183.602c0 .414.232.773.57.95z" fill="currentColor"/><path d="M8.429 9.327l-2.905 6.12a.78.78.0 01-1.05.373.807.807.0 01-.365-1.07l2.86-6.028c.143.418.533.718.991.718.169.0.328-.04.469-.113z" fill="currentColor"/><path d="M8.97 8.66l2.89 6.09a.807.807.0 01-.365 1.07.78.78.0 01-1.05-.372l-2.89-6.091c.124.053.261.083.405.083.481.0.886-.33 1.01-.78z" fill="currentColor"/><path d="M8.462 9.31a1.07 1.07.0 00.546-.938c0-.233-.073-.448-.198-.624l6.478 1.499a.8.8.0 01.592.958.786.786.0 01-.94.603L8.462 9.31zM8.746.9v6.766a1.037 1.037.0 00-1.572.0V.901c0-.443.352-.801.786-.801.434.0.786.358.786.8z" fill="currentColor"/><path d="M13.234 3.21a.776.776.0 011.104.126.81.81.0 01-.123 1.126L8.94 8.749c.043-.117.067-.244.067-.377.0-.516-.36-.946-.837-1.045l5.063-4.117z" fill="currentColor"/><path d="M7.96 3.302c-2.75.0-4.978 2.27-4.978 5.07s2.229 5.07 4.978 5.07c2.75.0 4.978-2.27 4.978-5.07.0-2.8-2.229-5.07-4.978-5.07zm-6.55 5.07c0-3.684 2.933-6.67 6.55-6.67 3.618.0 6.55 2.986 6.55 6.67.0 3.685-2.932 6.671-6.55 6.671-3.617.0-6.55-2.986-6.55-6.67z" fill="currentColor"/></svg>
</span></span><span class=dark:text-neutral-300>Le projet Inspektor Gadget fournit des outils (des <strong>gadgets</strong>) et un framework pour collecter les données et l&rsquo;<strong>inspection</strong> du système sur <strong>Kubernetes</strong>.</span></div><hr><h2 class="relative group">Bonus Track<div id=bonus-track class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#bonus-track aria-label=Ancre>#</a></span></h2><p>Pour finir la présentation, je vous partage quelques liens bien sympathiques que j&rsquo;ai trouvé lors de mes recherches sur les uProbes :</p><ul><li>Utilisation des uprobes <strong>sans eBPF</strong> par Brendan Gregg en 2015 :</li></ul><p><a href=https://www.brendangregg.com/blog/2015-06-28/linux-ftrace-uprobe.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Brendan Gregg blog" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-brendan.webp></figure></a></p><ul><li><a href=https://jvns.ca/blog/2017/07/05/linux-tracing-systems/ target=_blank>L&rsquo;excellent article de blog</a> de <strong>Julia Evans</strong> sur tous les systèmes de tracing sous Linux. Vous pouvez également lire son <em>zine</em> :</li></ul><p><a href=https://jvns.ca/linux-tracing-zine.pdf target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="Julia Evans zine" src=https://blog.littlejo.link/assets/screenshot/uprobe/linux-tracing.webp></figure></a></p><ul><li>Si les uProbes ne vous conviennent pas, peut-être que les <strong>bpftimes</strong> d&rsquo;Eunomia peuvent vous intéresser :</li></ul><p><a href=https://eunomia.dev/en/bpftime/ target=_blank><figure><img class="my-0 rounded-md" loading=lazy alt="bpftime: Userspace eBPF runtime for Observability, Network & General extensions Framework" src=https://blog.littlejo.link/assets/screenshot/uprobe/bpftime.webp></figure></a></p><p>Maintenant qu&rsquo;on a présenté uProbe et uRetProbe, voyons comment débuter son développement avec Aya.</p><hr><h2 class="relative group">Comment débuter son programme Aya ?<div id=comment-débuter-son-programme-aya- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#comment-d%c3%a9buter-son-programme-aya- aria-label=Ancre>#</a></span></h2><p>Quand on démarre le développement d&rsquo;un nouveau programme eBPF, la première difficulté est de réussir à le démarrer. Pour cela, il a besoin d&rsquo;un événement déclencheur (<em>event-driven</em>). Dans cet épisode, cet événement sera donc le passage d&rsquo;une uProbe ou d&rsquo;une uRetProbe dans le noyau Linux.</p><p>Aya nous facilite la tâche. Quand on lance la commande :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>cargo generate https://github.com/aya-rs/aya-template
</span></span></code></pre></div><p>Tu devras répondre à deux questions importantes qui permettront de définir cet événement :</p><pre tabindex=0><code>🤷   Target to attach the (u|uret)probe? (e.g libc):
🤷   Function name to attach the (u|uret)probe? (e.g getaddrinfo):
</code></pre><p>Voyons comment y répondre.</p><h3 class="relative group">Cible pour attacher l&rsquo;u•Ret•Probe<div id=cible-pour-attacher-luretprobe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#cible-pour-attacher-luretprobe aria-label=Ancre>#</a></span></h3><p>La première question demande le nom d&rsquo;une bibliothèque (comme la <code>libc</code>) ou d&rsquo;un binaire. La question aurait pu être posée autrement : quel fichier tu veux debugger ou tracer ?</p><p>Il faut voir ça comme un filtre :</p><ul><li>Si tu choisis <code>libc</code>, le programme eBPF ne pourra démarrer que si un programme de la <code>libc</code> est exécuté</li><li>Si tu choisis un binaire, il ne pourra démarrer que si le binaire est exécuté.</li></ul><p>Mais cela n&rsquo;est pas suffisant pour démarrer le programme eBPF. Il faut être plus précis : donner le nom d&rsquo;une fonction.</p><h3 class="relative group">Nom de la fonction pour attacher l&rsquo;u•Ret•Probe<div id=nom-de-la-fonction-pour-attacher-luretprobe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#nom-de-la-fonction-pour-attacher-luretprobe aria-label=Ancre>#</a></span></h3><p>La seconde question demande ainsi la fonction du binaire ou de la bibliothèque que tu veux débugger.</p><p>Par exemple :</p><ul><li>si tu choisis le nom d&rsquo;une fonction d&rsquo;un programme C, le programme eBPF sera lancé à chaque fois qu&rsquo;il passe par cette fonction.</li><li>si tu choisis une fonction de la <code>libc</code>, il ne sera lancé lorsqu&rsquo;un programme appellera cette fonction de la <code>libc</code>.</li></ul><p>Si cela vous parait un peu trop théorique, nous allons finir le chapitre en parlant d&rsquo;un outil bien sympathique qui va nous permettre d&rsquo;illustrer cela.</p><h3 class="relative group">S&rsquo;initier à eBPF avec bpftrace<div id=sinitier-à-ebpf-avec-bpftrace class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#sinitier-%c3%a0-ebpf-avec-bpftrace aria-label=Ancre>#</a></span></h3><p>Le projet <a href=https://github.com/bpftrace/bpftrace target=_blank>bpftrace</a> permet de créer rapidement la plupart des types de programme eBPF dédiés <strong>aux tracings</strong> dont notamment uProbe et uRetProbe mais également USDT, kProbe et kRetProbe (Voir la prise en charge <a href=https://bpftrace.org/docs/release_023/language#probes target=_blank>ici</a>).</p><p><figure><img class="my-0 rounded-md" loading=lazy alt="probe summary" src=https://blog.littlejo.link/assets/screenshot/uprobe/uprobe-summary.webp></figure></p><p>N&rsquo;hésitez pas <a href=https://github.com/bpftrace/bpftrace/blob/master/INSTALL.md#package-install target=_blank>à l&rsquo;installer</a>, il est probablement packagé pour votre distribution Linux favorite.</p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg>
</span></span><span class=dark:text-neutral-300>Le projet s&rsquo;est fortement inspiré de <a href=https://fr.wikipedia.org/wiki/DTrace target=_blank>DTrace</a>, un outil de tracing créé à l&rsquo;origine pour les unix comme Solaris, FreeBSD ou NetBSD au début des années 2000.</span></div><p>Trève de bavardage, prenons un exemple :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>sudo bpftrace -e <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>&#39;uretprobe:/bin/bash:readline { printf(&#34;%s\n&#34;, str(retval)); }&#39;</span>
</span></span></code></pre></div><p>Que veut dire cela ?</p><ul><li><code>uretprobe</code> : le type de programme eBPF</li><li><code>/bin/bash</code> : le binaire cible</li><li><code>readline</code> : le nom de la fonction</li><li><code>{ printf("%s\n", str(retval)); }</code> : le code du programme bpftrace (il affiche la valeur retour de la fonction)</li></ul><p>Cette commande crée ainsi un programme eBPF de type <strong>uRetProbe</strong> avec comme point d&rsquo;attache la fonction <strong>readline</strong> du binaire <strong>bash</strong>.</p><p>Si vous avez vraiment lancé la commande, vous allez voir que cette création est quasi immédiate ! Vérifions qu&rsquo;il fonctionne bien.</p><p>Démarrez un autre terminal et lancez quelques commandes de ton choix. Voici un exemple de ce que vous pourrez voir sur le terminal <em>bpftrace</em> :</p><pre tabindex=0><code>Attaching 1 probe...
ls -lrth
hello
man woman
</code></pre><p>Vous voyez toutes les commandes que vous avez tapé sur le terminal !</p><p>bpftrace peut ainsi être un bon moyen de prototyper un programme uProbe ou uRetProbe avant de le générer avec Aya.</p><p>Et si je veux observer une autre fonction que <code>readline</code> dans le programme bash ? Comment faire ? Le premier reflexe serait d&rsquo;aller dans le code de bash et de chercher une autre fonction mais il y a plus simple et plus sûr :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>bpftrace</span> <span class=na>-l</span> <span class=s1>&#39;uretprobe:/bin/bash:*&#39;</span>
</span></span></code></pre></div><p>Cette commande va te lister toutes les fonctions disponibles dans bash.</p><div class="flex px-4 py-3 rounded-md
alert-info"><span class="ltr:pr-3 rtl:pl-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M352 96v3.56C352 115.3 339.3 128 323.6 128H188.4c-15.7.0-29.3-12.7-29.3-28.44V96c0-53.02 43-96 96-96C309 0 352 42.98 352 96zM41.37 105.4c12.5-12.52 32.76-12.52 45.26.0l63.97 64C151.3 170 151.9 170.7 152.5 171.4 166.8 164.1 182.9 160 199.1 160H312C329.1 160 345.2 164.1 359.5 171.4 360.1 170.7 360.7 170 361.4 169.4l64-64c12.5-12.52 32.7-12.52 45.2.0 12.5 12.5 12.5 32.7.0 45.2l-64 64C405.1 215.3 405.3 215.9 404.6 216.5 410.7 228.5 414.6 241.9 415.7 256H480c17.7.0 32 14.3 32 32s-14.3 32-32 32H416c0 24.6-5.5 47.8-15.4 68.6C402.7 389.9 404.8 391.5 406.6 393.4l64 64c12.5 12.5 12.5 32.7.0 45.2s-32.7 12.5-45.2.0l-63.1-63c-24.5 21.8-55.8 36.2-90.3 39.6V240C272 231.2 264.8 224 255.1 224 247.2 224 239.1 231.2 239.1 240V479.2C205.5 475.8 174.2 461.4 149.7 439.6l-63.07 63c-12.5 12.5-32.76 12.5-45.26.0-12.49-12.5-12.49-32.7.0-45.2l64.03-64C107.2 391.5 109.3 389.9 111.4 388.6 101.5 367.8 96 344.6 96 320H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H96.3c1.08-14.1 5-27.5 11.1-39.5C106.7 215.9 106 215.3 105.4 214.6l-64.03-64c-12.49-12.5-12.49-32.7.0-45.2h0z"/></svg>
</span></span><span class=dark:text-neutral-300>On peut ainsi voir qu&rsquo;on peut débugger 1670 fonctions dans bash : <code>bpftrace -l 'uretprobe:/bin/bash:*' | wc -l</code></span></div><p>Ainsi bpftrace va nous permetre pour la suite de vérifier la faisabilité avant de créer le programme en Rust avec Aya.</p><hr><p>Dans cet épisode, on a vu les bases des uProbes et des uRetProbes : à quoi elles servent, leur histoire, qui les utilise et comment trouver le bon point d&rsquo;accroche. Nous avons également vu <em>bpftrace</em>, un outil qui permet de créer des probes rapidement.</p><p>Nous allons maintenant passer à la pratique dans l&rsquo;épisode suivant : on va créer un petit programme Go et on va le faire réagir avec des programmes eBPF de type uProbe et uRetProbe avec Aya.</p></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Apprenons uProbe avec eBPF et Aya -
Cet article fait partie d'une série.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Partie 1:
Cet article</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/ebpf-another-type/uprobe/example-1-tr/>Partie 2:
Observons une fonction simple de ton programme avec des uProbes</a></div></details><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.littlejo.link/ebpf-another-type/uprobe/intro/&amp;title=L%e2%80%99observabilit%c3%a9%20pour%20tous%20les%20d%c3%a9veloppeurs%20avec%20les%20uProbes" title="Poster sur LinkedIn" aria-label="Poster sur LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://bsky.app/intent/compose?text=L%e2%80%99observabilit%c3%a9%20pour%20tous%20les%20d%c3%a9veloppeurs%20avec%20les%20uProbes+https://blog.littlejo.link/ebpf-another-type/uprobe/intro/" title aria-label><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://s2f.kytta.dev/?text=L%e2%80%99observabilit%c3%a9%20pour%20tous%20les%20d%c3%a9veloppeurs%20avec%20les%20uProbes%20https://blog.littlejo.link/ebpf-another-type/uprobe/intro/" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://blog.littlejo.link/ebpf-another-type/uprobe/intro/&amp;subject=L%e2%80%99observabilit%c3%a9%20pour%20tous%20les%20d%c3%a9veloppeurs%20avec%20les%20uProbes" title="Envoyer par email" aria-label="Envoyer par email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_ebpf-another-type/uprobe/intro/index.md data-oid-likes=likes_ebpf-another-type/uprobe/intro/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span></span><span><a class="flex text-right group ml-3" href=/ebpf-another-type/uprobe/example-1-tr/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Observons une fonction simple de ton programme avec des uProbes</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-09-08T10:30:59+02:00>8 septembre 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Faire défiler jusqu'au bas de la page" title="Faire défiler jusqu'au bas de la page">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Joseph Ligier</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom):not(a > img)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://blog.littlejo.link/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Rechercher tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Fermer (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>