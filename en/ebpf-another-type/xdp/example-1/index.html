<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Let's Build a Tiny Firewall with XDP &#183; The Little Jo‚Äôs Blog</title><meta name=title content="Let's Build a Tiny Firewall with XDP &#183; The Little Jo‚Äôs Blog"><meta name=description content="Let‚Äôs see how to block traffic based on various criteria (MAC address, IP, protocol, port, etc.)."><meta name=keywords content="Rust,eBPF,aya,xdp,"><link rel=canonical href=https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/><meta name=author content="Joseph Ligier"><link href=https://bsky.app/profile/littlejo.bsky.social rel=me><link href=https://www.linkedin.com/in/joseph-ligier-4b86632 rel=me><link href=https://dev.to/littlejo rel=me><link href=https://medium.com/@littel.jo rel=me><link href=https://github.com/littlejo rel=me><link href=https://ko-fi.com/littlejo rel=me><meta property="og:url" content="https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/"><meta property="og:site_name" content="The Little Jo‚Äôs Blog"><meta property="og:title" content="Let's Build a Tiny Firewall with XDP"><meta property="og:description" content="Let‚Äôs see how to block traffic based on various criteria (MAC address, IP, protocol, port, etc.)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="ebpf-another-type"><meta property="article:published_time" content="2025-10-29T10:50:22+01:00"><meta property="article:modified_time" content="2025-10-29T10:50:22+01:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="EBPF"><meta property="article:tag" content="Aya"><meta property="article:tag" content="Xdp"><meta property="og:image" content="https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/featured.webp"><meta property="og:see_also" content="https://blog.littlejo.link/en/ebpf-another-type/xdp/example-3-tr/"><meta property="og:see_also" content="https://blog.littlejo.link/en/ebpf-another-type/xdp/example-2/"><meta property="og:see_also" content="https://blog.littlejo.link/en/ebpf-another-type/xdp/intro/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/featured.webp"><meta name=twitter:title content="Let's Build a Tiny Firewall with XDP"><meta name=twitter:description content="Let‚Äôs see how to block traffic based on various criteria (MAC address, IP, protocol, port, etc.)."><link type=text/css rel=stylesheet href=/css/main.bundle.min.b40b1ed6cd8b0f0b23d4e4d8d2cc52d50cc15b8e9d2c4b8e19a08fb960c4035326895dbbda305c98701405a07ac803e772fce0015b40d6e84c118999062b9ac3.css integrity="sha512-tAse1s2LDwsj1OTY0sxS1QzBW46dLEuOGaCPuWDEA1MmiV272jBcmHAUBaB6yAPncvzgAVtA1uhMEYmZBiuaww=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script type=text/javascript src=/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js integrity="sha512-mBTe6WFNMq61YjnRGO3+IKzWIxQk+bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Ebpf-Another-Types","name":"Let\u0027s Build a Tiny Firewall with XDP","headline":"Let\u0027s Build a Tiny Firewall with XDP","description":"Let‚Äôs see how to block traffic based on various criteria (MAC address, IP, protocol, port, etc.).","abstract":"Let‚Äôs see how to block traffic based on various criteria (MAC address, IP, protocol, port, etc.).","inLanguage":"en","url":"https:\/\/blog.littlejo.link\/en\/ebpf-another-type\/xdp\/example-1\/","author":{"@type":"Person","name":"Joseph Ligier"},"copyrightYear":"2025","dateCreated":"2025-10-29T10:50:22\u002b01:00","datePublished":"2025-10-29T10:50:22\u002b01:00","dateModified":"2025-10-29T10:50:22\u002b01:00","keywords":["Rust","eBPF","aya","xdp"],"mainEntityOfPage":"true","wordCount":"3166"}]</script><script data-goatcounter=https://littlejo-prd.goatcounter.com/count async src=/js/count.js></script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/en/ class="text-base font-medium">The Little Jo‚Äôs Blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/en/categories/introduction/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Introduction><p class="text-base font-medium">Blog</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium hover:text-primary-600 dark:hover:text-primary-400" title="Let's Build a Tiny Firewall with XDP">EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/ebpf-another-type/xdp/example-1/ class="flex items-center"><p class="text-sm font-sm hover:text-primary-600 dark:hover:text-primary-400" title="Impl√©mentons un petit firewall avec XDP">FR</p></a><a href=/en/ebpf-another-type/xdp/example-1/ class="flex items-center"><p class="text-sm font-sm hover:text-primary-600 dark:hover:text-primary-400" title="Let's Build a Tiny Firewall with XDP">EN</p></a></div></div></div></div><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span><div><div class="cursor-pointer flex items-center nested-menu"><span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium hover:text-primary-600 dark:hover:text-primary-400" title="Let's Build a Tiny Firewall with XDP">EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/ebpf-another-type/xdp/example-1/ class="flex items-center"><p class="text-sm font-sm hover:text-primary-600 dark:hover:text-primary-400" title="Impl√©mentons un petit firewall avec XDP">FR</p></a><a href=/en/ebpf-another-type/xdp/example-1/ class="flex items-center"><p class="text-sm font-sm hover:text-primary-600 dark:hover:text-primary-400" title="Let's Build a Tiny Firewall with XDP">EN</p></a></div></div></div></div><button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/en/categories/introduction/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Introduction><p class="text-bg font-bg">Blog</p></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/en/ebpf-another-type/xdp/example-1/featured_hu_7e4620a81e6b46a6.webp alt="Let's Build a Tiny Firewall with XDP" loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url=/en/ebpf-another-type/xdp/example-1/featured_hu_7e4620a81e6b46a6.webp></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/>The Little Jo‚Äôs Blog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/ebpf-another-type/>Ebpf-Another-Types</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/ebpf-another-type/xdp/example-1/>Let's Build a Tiny Firewall with XDP</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Let's Build a Tiny Firewall with XDP</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-10-29T10:50:22+01:00>29 October 2025</time><span class="px-2 text-primary-500">&#183;</span><span>3166 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">15 mins</span><span class="px-2 text-primary-500">&#183;</span><span class=mb-[2px]>
<span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt="Joseph Ligier" src=/img/littlejo_hu_4250d52962eec5b0.jpg data-zoom-src=/img/littlejo.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Joseph Ligier</div><div class="text-sm text-neutral-700 dark:text-neutral-400">CNCF ambassador | Kubestronaut üêù</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://bsky.app/profile/littlejo.bsky.social target=_blank aria-label=Bluesky title=Bluesky rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/joseph-ligier-4b86632 target=_blank aria-label=Linkedin title=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://dev.to/littlejo target=_blank aria-label=Dev title=Dev rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88.0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59.0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21.0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44.0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44.0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://medium.com/@littel.jo target=_blank aria-label=Medium title=Medium rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M180.5 74.262C80.813 74.262.0 155.633.0 256S80.819 437.738 180.5 437.738 361 356.373 361 256 280.191 74.262 180.5 74.262zm288.25 10.646c-49.845.0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559C559 161.5 518.6 84.908 468.752 84.908zm139.506 17.821c-17.526.0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/littlejo target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://ko-fi.com/littlejo target=_blank aria-label=Ko-Fi title=Ko-Fi rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg width="211.67mm" height="211.67mm" viewBox="0 0 211.67 211.67"><defs><clipPath id="clipPath25"><path d="m0 6e2h1654.8V0H0z" fill="currentColor"/></clipPath></defs><g transform="translate(-3.0786 -29.59)"><g transform="matrix(.35278 0 0 -.35278 3.0785 241.26)"><g clip-path="url(#clipPath25)"><g transform="translate(600 300)"><path d="m-3e2 3e2c-165.69.0-3e2-134.31-3e2-3e2s134.31-3e2 3e2-3e2C-134.32-3e2.0-165.69.0.0s-134.32 3e2-3e2 3e2zm-188.93-166.99h329.58c23.223.0 46.032-6.8325 65.073-20.125 18.412-12.856 36.378-33.646 42.697-67.02 14.674-77.514-43.568-135.76-126.12-131.18.438-21.268-3.8105-59.422-44.878-69.696-3.282-.821-6.6604-1.186-10.044-1.207-72.13-.448-222.53-.88916-222.53-.88916s-46.066-.01555-49.176 45.962c-1.023 77.88-.48339 223.69-.48339 223.69s-.02651 2.9267-.02051 3.6577c.043 5.607 4.4359 16.8 15.901 16.8zm312.71-55.573v-107.8s14.302-1.6507 31.907.54932c20.356 6.6 39.06 20.901 39.06 57.199.0 14.85-5.2614 25.601-11.837 33.239-9.341 10.848-23.152 16.809-37.469 16.809h-21.661z" fill="currentColor"/></g><g transform="translate(256.61 203.37)"><path d="m0 0c3.585-1.806 5.876.437 5.876.437s52.457 47.878 76.089 75.452c21.018 24.667 22.389 66.234-13.708 81.766-36.096 15.532-65.795-18.272-65.795-18.272-25.755 28.326-64.734 26.891-82.763 7.721-18.027-19.169-11.732-52.072 1.717-70.383 12.626-17.19 68.119-66.65 76.529-75.015.0.0.614-.641 2.055-1.706" fill="currentColor"/></g></g></g></g></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#lets-build-an-xdp-hello-world-program>Let&rsquo;s build an XDP hello world program</a><ul><li><a href=#lets-recreate-the-development-environment>Let&rsquo;s recreate the development environment</a></li><li><a href=#lets-create-the-hello-world-program>Let&rsquo;s create the ‚Äúhello world‚Äù program</a></li></ul></li><li><a href=#the-basics-of-creating-an-xdp-program>The basics of creating an XDP program</a><ul><li><a href=#xdp-actions>XDP actions</a></li><li><a href=#the-xdp-context-and-its-methods>The XDP context and its methods</a></li><li><a href=#how-to-retrieve-the-headers>How to retrieve the headers?</a></li></ul></li><li><a href=#guided-tour-of-the-different-headers>Guided tour of the different headers</a><ul><li><a href=#level-1-network-access>Level 1: Network access</a></li><li><a href=#level-2-internet>Level 2: Internet</a></li><li><a href=#level-3-transport>Level 3: Transport</a></li><li><a href=#level-4-application>Level 4: Application</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#lets-build-an-xdp-hello-world-program>Let&rsquo;s build an XDP hello world program</a><ul><li><a href=#lets-recreate-the-development-environment>Let&rsquo;s recreate the development environment</a></li><li><a href=#lets-create-the-hello-world-program>Let&rsquo;s create the ‚Äúhello world‚Äù program</a></li></ul></li><li><a href=#the-basics-of-creating-an-xdp-program>The basics of creating an XDP program</a><ul><li><a href=#xdp-actions>XDP actions</a></li><li><a href=#the-xdp-context-and-its-methods>The XDP context and its methods</a></li><li><a href=#how-to-retrieve-the-headers>How to retrieve the headers?</a></li></ul></li><li><a href=#guided-tour-of-the-different-headers>Guided tour of the different headers</a><ul><li><a href=#level-1-network-access>Level 1: Network access</a></li><li><a href=#level-2-internet>Level 2: Internet</a></li><li><a href=#level-3-transport>Level 3: Transport</a></li><li><a href=#level-4-application>Level 4: Application</a></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!1,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5" open><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">Getting Started with XDP in Aya -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/intro/>Part 1:
XDP: The Ultra-Fast Firewall Inside Linux</a></div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">Part 2:
This Article</div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/example-2/>Part 3:
Let's Mitigate DDoS Attacks with XDP</a></div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/example-3-tr/>Part 4:
Let's Create a Little Load Balancer with XDP</a></div></details><div class="article-content max-w-prose mb-20"><p>We saw what an XDP program is in <a href=/en/ebpf-another-type/xdp/intro/>part one</a>: it can be a way to filter a network stream.</p><p>In this part, I will take you on a brief tour of the different headers and show you how filtering can be done. We will see how to redevelop <code>xdp-filter</code> with the Rust Aya framework.</p><p>Follow the guide!</p><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="pe-3 flex items-center
alert-icon-tip"><span class="relative block icon"><svg fill="currentColor" width="800" height="800" viewBox="-2 -2 36 36"><title>lab</title><path d="M19.332 19.041s-1.664 2.125-3.79.0c-2.062-2-3.562.0-3.562.0l-4.967 9.79c-.144.533.173 1.081.706 1.224h16.497c.533-.143.85-.69.707-1.224l-5.591-9.79zm7.607 9.289-7.979-13.428v-.025l-.014-7.869h.551c.826.0 1.498-.671 1.498-1.499.0-.827-.672-1.498-1.498-1.498h-7.995c-.827.0-1.498.671-1.498 1.498.0.828.671 1.499 1.498 1.499h.482l-.016 7.871L5.06 28.33c-.428 1.599.521 3.242 2.119 3.67H24.82c1.6-.428 2.549-2.071 2.119-3.67zm-2.386 2.668-17.108-.019c-1.065-.286-1.697-1.382-1.412-2.446l6.947-13.616.021-8.908h-1.498c-.275.0-.499-.224-.499-.5s.224-.499.499-.499h7.995c.275.0.498.224.498.499.0.276-.223.5-.498.5H18l.025 8.875 7.939 13.666c.286 1.067-.347 2.163-1.411 2.448zM16.48 2.512c0 .552.448 1 1 1s1-.448 1-1-.447-1-1-1-1 .447-1 1zm-3 0c.553.0 1-.448 1-1s-.447-1-1-1-1 .448-1 1 .447 1 1 1z"/></svg>
</span></span><span class=dark:text-neutral-300><p>I assume you are already in an <a href=https://aya-rs.dev/book/start/development/ target=_blank>environment for developing with Aya</a>.
If not, you can use the Killercoda lab:</p><p><a href=https://killercoda.com/littlejo/course/aya-prod/aya-xdp target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Killer coda screenshot" src=https://blog.littlejo.link/assets/screenshot/xdp/killercoda.webp></figure></a></p></span></div><hr><h2 class="relative group">Let&rsquo;s build an XDP hello world program<div id=lets-build-an-xdp-hello-world-program class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lets-build-an-xdp-hello-world-program aria-label=Anchor>#</a></span></h2><h3 class="relative group">Let&rsquo;s recreate the development environment<div id=lets-recreate-the-development-environment class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lets-recreate-the-development-environment aria-label=Anchor>#</a></span></h3><p>As we saw in the previous section, I suggest installing namespaces:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>git</span> clone https://github.com/littlejo/eunomia.dev
</span></span><span class=line><span class=cl><span class=k>cd</span> eunomia.dev/docs/tutorials/<span class=m>42</span>-xdp-loadbalancer/
</span></span><span class=line><span class=cl>./setup.sh
</span></span></code></pre></div><p>Let&rsquo;s recall what we created:</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=namepaces src=https://blog.littlejo.link/assets/svg/xdp/namespaces.svg></figure></p><h3 class="relative group">Let&rsquo;s create the ‚Äúhello world‚Äù program<div id=lets-create-the-hello-world-program class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lets-create-the-hello-world-program aria-label=Anchor>#</a></span></h3><p>As we did with <code>xdp-filter</code>, we will install the XDP program on <code>veth0</code>.</p><p>Let&rsquo;s generate the Aya program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>cargo</span> generate <span class=na>--name</span> browser-xdp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>               <span class=na>-d</span> <span class=nv>program_type</span><span class=o>=</span>xdp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>               <span class=na>-d</span> <span class=nv>default_iface</span><span class=o>=</span>veth0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>               <span class=nf>https</span>://github.com/aya-rs/aya-template
</span></span></code></pre></div><p>Let&rsquo;s build and install the ‚Äúhello world‚Äù program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=k>cd</span> browser-xdp/
</span></span><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>On another terminal, let&rsquo;s test the program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>lb ping <span class=na>-c</span> <span class=m>2</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span>
</span></span></code></pre></div><p>On the <code>cargo run</code> terminal, we can clearly see two packets:</p><pre tabindex=0><code>[INFO  browser_xdp] received a packet
[INFO  browser_xdp] received a packet
</code></pre><p>So every time the interface receives a packet, the XDP program is launched.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="namepaces with xdp program" src=https://blog.littlejo.link/assets/svg/xdp/namespaces-xdp-ping.svg></figure></p><p>Now we&rsquo;ll see how to stop a packet and what type of packet we&rsquo;re dealing with.</p><hr><h2 class="relative group">The basics of creating an XDP program<div id=the-basics-of-creating-an-xdp-program class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-basics-of-creating-an-xdp-program aria-label=Anchor>#</a></span></h2><h3 class="relative group">XDP actions<div id=xdp-actions class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#xdp-actions aria-label=Anchor>#</a></span></h3><p>Let&rsquo;s first look at the code generated by <code>cargo</code>.</p><p>The most important file is this one: <code>browser-xdp-ebpf/src/main.rs</code>, i.e., the kernel-side code.</p><p>Overall, the code looks like the code generated for other types of eBPF programs such as Tracepoints:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=cp>#[xdp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>u32</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>ret</span><span class=p>,</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nb>Err</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>xdp_action</span>::<span class=no>XDP_ABORTED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;received a packet&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>However, there is one small difference: <code>xdp_action::*</code>.</p><p>This determines what the packet does once it has finished traversing the eBPF program.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="ebpf documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/xdp-2.webp></figure></p><p>There are five different actions:</p><ul><li><code>XDP_ABORTED</code>: Stops the packet with an error</li><li><code>XDP_DROP</code>: Stops the packet silently</li><li><code>XDP_PASS</code>: Lets the packet continue through the network stack.</li><li><code>XDP_REDIRECT</code>: Redirects the packet to another interface or to an <code>AF_XDP</code> socket attached to an interface.</li><li><code>XDP_TX</code>: Redirects the packet to the same interface</li></ul><p>In this article, we will only use <code>XDP_PASS</code> and <code>XDP_DROP</code>.</p><h3 class="relative group">The XDP context and its methods<div id=the-xdp-context-and-its-methods class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-xdp-context-and-its-methods aria-label=Anchor>#</a></span></h3><p>As with all other eBPF programs, to go beyond <em>hello world</em>, you need to understand how to work with the context.</p><p>Let&rsquo;s take a look at the documentation:</p><p><a href=https://docs.rs/aya-ebpf/latest/aya_ebpf/programs/xdp/struct.XdpContext.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Aya documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/xdp-aya.webp></figure></a></p><p>Unlike previous types of programs where only one method was used, there are four different methods for XDP:</p><ul><li><code>data()</code> returns the memory address of the start of the network packet.</li><li><code>data_end()</code> returns the memory address of the end of the network packet.</li><li><code>metadata()</code> returns the memory address of the start of the XDP metadata linked to the Linux kernel or driver.</li><li><code>metadata_end()</code> returns the memory address of the end of the metadata. In the same way as <code>data_end()</code>,</li></ul><p>In this article, we will only use the <code>data()</code> and <code>data_end()</code> methods to retrieve the different headers.</p><h3 class="relative group">How to retrieve the headers?<div id=how-to-retrieve-the-headers class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#how-to-retrieve-the-headers aria-label=Anchor>#</a></span></h3><p>Let&rsquo;s recall the following diagram:<figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=headers src=https://blog.littlejo.link/assets/svg/xdp/packet-headers.svg></figure></p><ul><li><code>data()</code> is located at the beginning of the <em>ethHdr</em> header</li><li><code>data_end()</code> is located at the end of the payload</li></ul><p>How do we retrieve the Ethernet header (<em>ethHdr</em>)? It is located at the very beginning of the packet.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>To retrieve the next header, simply add the length of the Ethernet header. In Rust pseudo-code, this would look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ipv4hdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sizeof</span><span class=p>(</span><span class=n>ethhdr</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Etc.</p><p>Let&rsquo;s focus on the Ethernet header. How can we retrieve its elements? <code>ctx.data()</code> is of type <code>usize</code>. This is a natural integer that represents a memory address. We therefore need to retrieve its content. How can we do this?</p><p>In the same way that <code>*const u8</code> represents a pointer to a character string, we must do the same for the Ethernet header.</p><p>We must therefore convert it into a structure that represents the Ethernet frame header. There are several ways to do this, such as looking at the C code and converting it to Rust, which is a good exercise but a little tedious. Fortunately, since Rust is now well established in the eBPF ecosystem, there is already a Rust crate that has done the work for us: <a href=https://docs.rs/network-types/latest/network_types/index.html target=_blank>network-types</a>.</p><p><a href=https://docs.rs/network-types/latest/network_types/eth/index.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="network-types documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/network-types.webp></figure></a></p><p>To retrieve this crate, we will modify the <code>browser-xdp-ebpf/Cargo.toml</code> file and add the following to the <em>dependencies</em> section:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Toml data-lang=Toml><span class=line><span class=cl><span class=nx>network-types</span> <span class=p>=</span> <span class=s2>&#34;0.1.0&#34;</span>
</span></span></code></pre></div><p>We will then be able to include it in the main code (<code>browser-xdp-ebpf/src/main.rs</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>network_types</span>::<span class=n>eth</span>::<span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=o>..</span><span class=p>.]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Now that we have retrieved the Ethernet header structure, we can retrieve the various elements the header consists of:</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=ethhdr src=https://blog.littlejo.link/assets/svg/xdp/packet-ethhdr.svg></figure></p><ul><li>DST MAC: the destination MAC address</li><li>SRC MAC: the source MAC address</li><li><a href=https://en.wikipedia.org/wiki/EtherType target=_blank>ETHERTYPE</a>: determines the upper-layer protocol (such as IPv4, IPv6, or Arp, to name the most well-known).</li></ul><p>How can this be done with Aya? Let&rsquo;s review the documentation:</p><p><a href=https://docs.rs/network-types/latest/network_types/eth/struct.EthHdr.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="ethhdr documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/ethhdr.webp></figure></a></p><p>So to retrieve the destination address, simply code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dst_addr {:mac} &#34;</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>We have to use <code>unsafe</code> because we are dereferencing a raw pointer.</p><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="pe-3 flex items-center
alert-icon-tip"><span class="relative block icon"><svg width="1114.9938" height="737.55341" viewBox="0 0 1114.9938 737.55341" style="clip-rule:evenodd;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421" id="svg47080"><g id="layer8" transform="translate(-424.6391,-562.834)"/><g id="layer7" transform="translate(-424.6391,-562.834)"><g id="layer3" style="display:inline"><g id="Layer-1" style="clip-rule:evenodd;display:inline;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421" transform="translate(400,525)"><g transform="translate(597.344,637.02)" id="g47033" style="fill:#000"><path d="m0-279.559c-121.238.0-231.39 14.576-312.939 38.329V-38.329C-231.39-14.575-121.238.0.0.0 138.76.0 262.987-19.092 346.431-49.186V-230.37C262.987-260.465 138.76-279.559.0-279.559" style="fill:#000;fill-rule:nonzero" id="path47031"/></g><g transform="translate(1068.75,575.642)" id="g47037" style="fill:#000"><path d="m0-53.32-14.211-29.441c.073-1.118.131-2.237.131-3.36.0-33.375-34.706-64.135-93.097-88.762V2.643c27.245-11.492 49.348-24.317 65.156-38.125-4.652 18.707-20.564 56.553-33.25 83.168-20.85 38.066-28.4 71.203-27.432 72.844.617 1.033 7.73-9.94 18.219-27.721C-60.074 58.028-13.82-8.373-4.575-25.287 5.897-44.461.0-53.32.0-53.32" style="fill:#000;fill-rule:nonzero" id="path47035"/></g><g transform="translate(149.064,591.421)" id="g47041" style="fill:#000"><path d="m0-99.954c0 6.428 1.293 12.76 3.788 18.969l-8.511 15.15s-6.818 8.846 5.188 27.508C11.055-21.872 64.1 42.54 92.097 76.271c12.026 17.293 20.179 27.945 20.893 26.916 1.124-1.633-7.476-34.1-31.359-71.141-11.144-19.895-24.454-46.252-32.442-65.721 22.303 14.116 51.483 26.92 86.152 37.94V-204.17C51.797-177.622.0-140.737.0-99.954" style="fill:#000;fill-rule:nonzero" id="path47039"/></g><g transform="translate(450.328,483.629)" id="g47049"><path d="m0 167.33c-1.664-1.42-2.536-2.262-2.536-2.262l142.542-11.677C23.733.0-69.418 122.193-79.333 135.855v31.475z" style="fill-rule:nonzero" id="path47047"/></g><g transform="translate(747.12,477.333)" id="g47053"><path d="m0 171.974c1.663-1.42 2.536-2.264 2.536-2.264l-136.984-10.023C-18.12.0 69.421 126.835 79.335 140.497v31.477z" style="fill-rule:nonzero" id="path47051"/></g></g></g><g id="layer2" style="display:inline"><g transform="translate(1533.408,803.891)" id="g47045" style="clip-rule:evenodd;display:inline;fill:#currentcolor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 240.343-93.415-68.811c-.88-3.064-1.756-6.127-2.662-9.162l30.683-44.451c3.13-4.522 3.765-10.398 1.731-15.555-2.037-5.13-6.491-8.81-11.763-9.71l-51.884-8.805c-2.008-4.102-4.116-8.142-6.23-12.15l21.797-49.903c2.243-5.087 1.769-10.995-1.203-15.608-2.961-4.636-7.99-7.344-13.349-7.133l-52.656 1.913c-2.727-3.55-5.496-7.068-8.321-10.521l12.1-53.49c1.225-5.433-.322-11.118-4.103-15.064-3.762-3.932-9.229-5.559-14.426-4.283l-51.289 12.608c-3.321-2.935-6.698-5.833-10.114-8.673l1.848-54.914c.198-5.559-2.393-10.842-6.844-13.925-4.446-3.104-10.093-3.573-14.956-1.266l-47.847 22.747c-3.854-2.21-7.728-4.4-11.644-6.517l-8.455-54.115c-.857-5.483-4.385-10.139-9.326-12.266-4.923-2.137-10.568-1.447-14.891 1.808l-42.659 32.007c-4.2-1.395-8.419-2.732-12.692-4.011l-18.386-51.316c-1.87-5.229-6.181-9.071-11.438-10.151-5.239-1.072-10.63.742-14.263 4.802l-35.906 40.171c-4.343-.5-8.686-.956-13.043-1.331l-27.724-46.713c-2.81-4.732-7.77-7.612-13.116-7.612-5.334.0-10.304 2.88-13.09 7.612l-27.733 46.713c-4.358.375-8.722.831-13.056 1.331l-35.91-40.171c-3.636-4.06-9.047-5.874-14.268-4.802-5.255 1.092-9.573 4.922-11.433 10.151l-18.402 51.316c-4.26 1.279-8.481 2.627-12.691 4.011l-42.644-32.007c-4.336-3.266-9.98-3.955-14.916-1.808-4.919 2.127-8.461 6.783-9.313 12.266l-8.461 54.115c-3.914 2.117-7.789 4.294-11.653 6.517l-47.842-22.747c-4.858-2.316-10.529-1.838-14.954 1.266-4.445 3.083-7.042 8.366-6.84 13.925l1.835 54.914c-3.405 2.84-6.774 5.738-10.112 8.673l-51.279-12.608c-5.21-1.265-10.67.351-14.441 4.283-3.795 3.946-5.331 9.631-4.113 15.064l12.079 53.49c-2.802 3.467-5.575 6.971-8.293 10.521l-52.655-1.913c-5.314-.157-10.386 2.497-13.356 7.133-2.973 4.613-3.423 10.521-1.213 15.608l21.816 49.903c-2.119 4.008-4.224 8.048-6.249 12.15l-51.887 8.805c-5.27.888-9.71 4.566-11.76 9.71-2.04 5.157-1.37 11.033 1.73 15.555l30.7 44.451c-.24.784-.46 1.577-.7 2.364l-86.77 92.17s-13.29 10.423 6.07 34.916c17.07 21.605 104.724 107.252 151.018 152.123 19.554 22.779 32.948 36.886 34.349 35.666 2.208-1.94-9.387-43.385-47.902-92.012-29.685-43.629-68.215-110.733-59.175-118.467.0.0 10.27-13.045 30.893-22.435.753.603-.781-.598.0.0.0.0 435.152 200.732 838.797 3.396 46.108-8.273 74.023 16.43 74.023 16.43 9.628 5.58-15.301 74.578-35.798 120.254-27.881 51.863-31.97 92.332-29.604 93.736 1.491.889 11.634-14.545 26.104-39.109C-79.843 391.654-12.354 296.816.0 273.782c14.006-26.119.0-33.439.0-33.439" style="fill:currentColor;fill-rule:nonzero" id="path47043"/></g></g><g id="layer5"><ellipse style="fill:#000;stroke:#000;stroke-width:1.77505" id="path319" cx="984.21155" cy="974.09283" rx="228.89882" ry="131.31676"/><ellipse style="fill:#000;fill-opacity:0;stroke:#000;stroke-width:38.6157;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path423" cx="982.29688" cy="969.62152" rx="306.21515" ry="161.31026"/><ellipse style="clip-rule:evenodd;fill:#000;fill-opacity:0;fill-rule:evenodd;stroke:#000;stroke-width:39.8062;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path423-3" cx="978.92542" cy="932.41345" rx="396.3967" ry="212.5099"/></g><g id="layer6" style="display:inline"><ellipse style="clip-rule:evenodd;fill:currentColor;fill-opacity:1;fill-rule:evenodd;stroke:#000;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path977" cx="971.17297" cy="350.80408" rx="241.7849" ry="72.576942" transform="rotate(22.166895)"/><ellipse style="clip-rule:evenodd;fill:currentColor;fill-opacity:1;fill-rule:evenodd;stroke:#000;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="ellipse2369" cx="-859.38287" cy="1097.5022" rx="241.7849" ry="72.576942" transform="matrix(-0.92608874,0.37730576,0.37730576,0.92608874,0,0)"/><g id="g3771" transform="translate(400,525)"><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2509-3" d="m176.76083 102.59373c10.48622 2.15024 20.88 4.71573 31.29237 7.1917 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.23611-12.08759-3.35416-10.1347-2.628217-20.21057-5.478978-30.40597-7.861622l-12.16816 8.454102z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2511-6" d="m402.92414 156.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2513-7" d="m535.85588 225.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2509" d="m582.76083 621.59374c10.48622 2.15023 20.88 4.71572 31.29237 7.19169 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.2361-12.08759-3.35416-10.1347-2.62821-20.21057-5.47897-30.40597-7.86162l-12.16816 8.45411z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2511" d="m804.92414 673.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2513" d="m937.85588 742.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/><g id="g3789" transform="matrix(-1,0,0,1,1567.5877,525)"><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3783" d="m176.76083 102.59373c10.48622 2.15024 20.88 4.71573 31.29237 7.1917 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.23611-12.08759-3.35416-10.1347-2.628217-20.21057-5.478978-30.40597-7.861622l-12.16816 8.454102z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3785" d="m402.92414 156.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3787" d="m535.85588 225.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g><g id="g3797" transform="matrix(-1,0,0,1,1567.5877,525)" style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-opacity:1"><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3791" d="m182.76083 96.593738c10.48622 2.150236 20.88 4.715722 31.29237 7.191692 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.852665-4.03736-1.088204-8.05839-2.236108-12.08759-3.354163-10.1347-2.628215-20.21057-5.478976-30.40597-7.86162l-12.16816 8.454106z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3793" d="m404.92414 148.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3795" d="m537.85588 217.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g></g><g id="layer4"><g transform="translate(1366.094,1336.034)" id="g47057" style="clip-rule:evenodd;display:inline;fill:#333;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-314.014s-15.576 62.041-112.453 127.238l-27.166 6.367s-87.881-160.259-212.383 20.334c0 0 38.802-22.591 142.822 4.92.0.0-47.85 73.239-144.242 70.989.0.0 92.373 110.82 232.94-49.252.0.0 148.595-57.463 160.646-180.596z" style="fill:#333;fill-rule:nonzero" id="path47055"/></g><g transform="translate(841.397,1212.635)" id="g47077" style="clip-rule:evenodd;display:inline;fill:#333;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="M0-25.102C91.833-36.676 144.904-37.754 144.904-37.754 22.037-199.838-77.661-53.098-77.661-53.098c-24.982-8.932-50.453-43.613-69.477-75.59l-76.237-22.58C-135.502-2.127-70.08.146-70.08.146 66.134 174.736 130.663 34.441 130.663 34.441 54.195 25.759.0-25.102.0-25.102" style="fill:#333;fill-rule:nonzero" id="path47075"/></g></g><g id="layer1" style="display:inline"><g transform="translate(1077.392,1034.61)" id="g47061" style="clip-rule:evenodd;display:inline;fill:currentColor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-92.063s43.486-47.615 86.974.0c0 0 34.17 63.492.0 95.234.0.0-55.912 44.444-86.974.0.0.0-37.275-34.921.0-95.234" style="fill:currentColor;fill-rule:nonzero" id="path47059"/></g><g transform="translate(1127.738,960.209)" id="g47065" style="clip-rule:evenodd;display:inline;fill:#000;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 .002c0 18.541-10.93 33.572-24.408 33.572-13.477.0-24.406-15.031-24.406-33.572.0-18.541 10.929-33.574 24.406-33.574C-10.93-33.572.0-18.539.0.002" style="fill:#000;fill-rule:nonzero" id="path47063"/></g><g transform="translate(883.3,1027.984)" id="g47069" style="clip-rule:evenodd;display:inline;fill:currentColor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-98.439s74.596-33.028 94.956 40.691c0 0 21.327 85.926-61.259 90.776.0.0-105.31-20.283-33.697-131.467" style="fill:currentColor;fill-rule:nonzero" id="path47067"/></g><g transform="translate(920.766,961.428)" id="g47073" style="clip-rule:evenodd;display:inline;fill:#000;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 0c0 19.119-11.27 34.627-25.173 34.627-13.898.0-25.171-15.508-25.171-34.627.0-19.124 11.273-34.627 25.171-34.627C-11.27-34.627.0-19.124.0.0" style="fill:#000;fill-rule:nonzero" id="path47071"/></g></g></g></svg>
</span></span><span class=dark:text-neutral-300>Note that the <code>info!</code> macro allows us to convert 6-byte arrays into a MAC addresses. If you prefer uppercase notation, just use <code>:MAC</code>.</span></div><p>Now let&rsquo;s try it. Here is the modified main code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>network_types</span>::<span class=n>eth</span>::<span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dst_addr {:mac} &#34;</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;received a packet&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s build the program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>cargo</span> build
</span></span></code></pre></div><p>The compilation works.</p><p>Let&rsquo;s install it in the kernel:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>We then get the following error:</p><pre tabindex=0><code>Error: the BPF_PROG_LOAD syscall failed. Verifier output: 0: R1=ctx() R10=fp0
; unsafe { (*self.ctx).data as usize } @ xdp.rs:16
0: (61) r1 = *(u32 *)(r1 +0)          ; R1_w=pkt(r=0)
; let dst_addr = unsafe { (*ethhdr).dst_addr}; @ main.rs:20
1: (71) r0 = *(u8 *)(r1 +1)
invalid access to packet, off=1 size=1, R1(id=0,off=1,r=0)
R1 offset is outside of the packet
verification time 65 usec
stack depth 0
processed 2 insns (limit 1000000) max_states_per_insn 0 total_states 0 peak_states 0 mark_read 0


Caused by:
    Permission denied (os error 13)
</code></pre><p>The <em>verifier</em> doesn&rsquo;t really like this part of the code:</p><pre tabindex=0><code>let ethhdr = ctx.data() as *const EthHdr;
</code></pre><div class="flex px-4 py-3 rounded-md
alert-info"><span class="pe-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg width="35.895355" height="36.001198" viewBox="0 0 35.895355 36.001198" fill="none" id="svg13"><path fill-rule="evenodd" clip-rule="evenodd" d="m23.6364.10692772c.484.244422.6756.829517.4279 1.30684198-.489.9425-.7536 2.29434-.8548 3.68384-.0998 1.37144-.0333 2.66933.0689 3.4332.0712.53167-.308 1.01948-.847 1.08955s-1.0337-.30413-1.1048-.83581c-.1203-.89834-.1899-2.32813-.0808-3.82659.1078-1.4804.3972-3.14069 1.0658-4.42931998.2477-.4773282.8408-.666135 1.3248-.421712z" fill="#1a1a1a" id="path1"/><path d="m17.9279 15.4786c.591-2.7701-5.4162-3.2222-8.49374-3.1019-12.13253.2574-7.06117 7.5956-.344 8.4137 2.76434.3367 8.09894-1.8492 8.83774-5.3118z" fill="currentColor" id="path2"/><path d="m3.00152 13.9149c.34054-.2771.78266-.5279 1.33721-.743l.17291.5359.88014 1.0998 1.28927 1.153.9905-.145 4.95105-.5064 5.2045.5492c-.1637.515-.4287.9991-.7694 1.4477C15.5173 17.0017 11.9211 16.9114 9.96784 16.9078 9.44518 17.5136 9.25598 19.5736 9.2151 20.8038 9.17288 20.7999 9.1312 20.7954 9.09009 20.7904 8.54185 20.7236 8.00457 20.6134 7.48672 20.4672 7.43882 19.5053 7.77515 18.1299 8.01989 17.3664 6.48879 17.4486 4.86925 18.1947 3.97602 18.7145 3.56434 18.3884 3.20739 18.0402 2.91797 17.6812l1.98456-1.0757C4.59621 16.4519 3.62819 14.9452 3.00152 13.9149z" fill="currentColor" id="path3"/><path d="M16.8986 18.8203l1.7838 1.1899-8.0602 11.7636-1.9367-1.2919-1.48753-2.1642-.74485-3.5732 1.33387-3.1389 3.20141.9634z" fill="currentColor" id="path4"/><path fill-rule="evenodd" clip-rule="evenodd" d="M15.2758 11.0042c2.3911-5.0861403 8.2076-3.8391103 10.9546-2.0068003L18.6815 20.0147 17.8151 19.4368c-1.1 1.2586-3.3469 2.2113-4.3328 2.5303.1001 1.4145 1.3034 2.5052 1.8925 2.8737l-2.4801 3.6196c-2.89488-1.931-3.74047-4.6925-3.80141-5.8318l-1.0745-.0575c-1.89715 4.2428 1.07775 7.5309 2.91251 8.7548L7.72792 36.0012 8.28497 31.6116c-3.61109-3.0533-2.96504-7.6667-2.19063-9.5917C3.60654 21.5324-.71116398 17.9714.09996132 14.9451 1.51225 9.6757097 10.7796 9.7630597 15.2758 11.0042zm2.6538 4.4605c.5621-2.7545-5.4263-3.2044-8.49737-3.0844-1.95229.0414-3.45912.2662-4.5853.6176.50118 1.5357 1.66332 2.2994 2.22769 2.4976 3.56078-.7988 8.18428-.4303 10.85498-.0308zM17.705 16.192c-1.8625-.2387-4.6377-.3002-6.0775-.2966-1.95525 1.3169-2.20603 3.5377-2.03968 4.9319 2.64838.0449 6.94048-1.776 8.11718-4.6353zm-9.01016 4.5464c-.35729-2.0196.79278-3.9252 1.49856-4.7008-3.62095.1363-5.90362 1.15-7.01878 1.9457 1.19325 1.2879 3.24214 2.3888 5.52022 2.7551zM2.5405 17.15c.89512-.5396 2.4988-1.0361 3.3714-1.2581-1.26155-.9307-1.8124-1.9023-2.00718-2.5311-1.97331.9358-2.197 2.4008-1.36422 3.7892z" fill="#1a1a1a" id="path5"/><path fill-rule="evenodd" clip-rule="evenodd" d="m35.5569 8.0548297c-.4102-.35197-1.0318-.30931-1.3885.09529-.7042.79888-1.8771 1.54484-3.1462 2.1552803-1.2527.6024-2.4981 1.0253-3.2547 1.2163-.5265.1329-.844.6619-.7091 1.1814.1349.5195.6711.8329 1.1977.6999.8897-.2246 2.2604-.6937 3.6291-1.352 1.3521-.6503 2.8058-1.534 3.7687-2.6262703.3566-.4046.3132-1.01792-.097-1.3699z" fill="#1a1a1a" id="path6"/><path d="m23.2275 19.0151c2.385-1.5734 5.0488 3.7584 6.0825 6.621 4.2791 11.2045-4.5124 9.2957-7.785 3.4503-1.3468-2.4055-1.2788-8.1045 1.7025-10.0713z" fill="currentColor" id="path7"/><path d="m30.2594 32.1c.1337-.4151.2048-.9133.2005-1.5012L29.8914 30.6402 28.529 30.2441 26.9642 29.4933 26.7315 28.5324l-1.3687-4.7219L22.9067 19.25c-.4233.3418-.7798.7648-1.0748 1.2439.8604 1.297 2.2853 4.556 3.0167 6.343-.3751.7043-2.242 1.6452-3.3838 2.1411.0194.0372.0392.0737.0592.1095.2671.477.571.9279.9015 1.3475.9225-.3145 2.0908-1.135 2.7176-1.6436.4933 1.4325.3951 3.1933.2391 4.2049.4601.2554.9206.4525 1.3661.5837l.2722-2.2179c.2586.2232 2.0364.548 3.2389.7379z" fill="currentColor" id="path8"/><path d="m20.4651 21.1977-1.7838-1.1899-8.0602 11.7636 1.9367 1.2919 2.5898.5554 3.6382-.6495 2.4552-2.391-2.0992-2.5722z" fill="currentColor" id="path9"/><path fill-rule="evenodd" clip-rule="evenodd" d="M28.4238 19.774C32.3164 15.6893 28.976 10.8284 26.229 8.9960897L18.6802 20.0134l.8664.578c-.7738 1.4761-.8325 3.8884-.7651 4.9099-1.3678.4355-2.8419-.2597-3.4081-.6618l-2.48 3.6196c2.8948 1.931 5.8072 1.6761 6.9015 1.3073l.4544.9624c-3.2834 3.3181-7.4845 1.8196-9.3193.5958l-3.20344 4.6753 3.92084-2.1458c4.2173 2.1685 8.3155-.1422 9.8375-1.5687 1.3855 2.0962 6.3437 4.7225 8.8878 2.8521 4.4296-3.2567.8939-11.7094-1.9489-15.3635zm-5.1841-.7677c2.3812-1.5411 5.036 3.7742 6.0675 6.6308.6886 1.8029 1.0387 3.2663 1.1278 4.4284-1.6311.1134-2.7824-.666-3.1791-1.1089-.5757-3.5579-2.6452-7.6538-4.0162-9.9503zm-.6003.4767c.9185 1.6163 2.0106 4.1343 2.5437 5.4541-.51 2.2809-2.5052 3.3381-3.8784 3.7053-1.0291-2.4081-.916-7.0166 1.3347-9.1594zm-.9184 9.9439c2.0327-.4255 3.3963-2.1886 3.8628-3.1238 1.2211 3.3661 1.1184 5.8339.7856 7.1514-1.656-.6126-3.4549-2.0783-4.6484-4.0276zm5.6684 4.2977c.174-1.0207.0433-2.674-.073-3.5557 1.3454.8082 2.4645.9505 3.1284.8946-.1447 2.1554-1.4393 2.9062-3.0554 2.6611z" fill="#1a1a1a" id="path10"/></svg>
</span></span><span class=dark:text-neutral-300>When we try to install an eBPF program in the Linux kernel, there is a Linux program (the <em>verifier</em>) that checks the code to prevent us from breaking the security of the Linux kernel.</span></div><p>The important part of the error is:</p><pre tabindex=0><code>invalid access to packet,
R1 offset is outside of the packet
</code></pre><p>Not very clear. Let&rsquo;s try to explain it better. When we try <code>let ethhdr = ctx.data() as *const EthHdr;</code>, there is memory access. The <em>verifier</em> requires us to prove that this access is always within the packet (between <code>data()</code> and <code>data_end()</code>).</p><p>We therefore need to perform a check to reassure it before this access:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data_end</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This can be translated as: if the access is not at the packet level, the XDP program does not process the packet: it lets it continue on its way in the Linux kernel network stack.</p><p>Otherwise, we can convert it to <code>EthHdr</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Here is the complete code for the main function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>()</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data_end</span><span class=p>()</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>//Check for the verifier
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>);</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dst_addr {:mac} &#34;</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;received a packet&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s check that it works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>Let&rsquo;s run some pings. We successfully retrieve the MAC address:</p><pre tabindex=0><code>[INFO  browser_xdp] dst_addr de:ad:be:ef:00:01
[INFO  browser_xdp] received a packet
[INFO  browser_xdp] dst_addr de:ad:be:ef:00:01
[INFO  browser_xdp] received a packet
</code></pre><p>Now that we have successfully retrieved the <code>ethHdr</code> header, how do we retrieve the other headers? Simply add the lengths of the preceding headers.</p><p>Obviously, we will use very similar methods for all headers. It would be wise to create a function. Here it is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>core</span>::<span class=n>mem</span>::<span class=n>size_of</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>ptr_at</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>XdpContext</span><span class=p>,</span><span class=w> </span><span class=n>offset</span>: <span class=kt>usize</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;*</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=kt>u16</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=n>data_end</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size_of</span>::<span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>offset</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>((</span><span class=n>start</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>offset</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>A few notes on creating this function:</p><ul><li>(L3) We <em>inline</em> the function for performance reasons</li><li>(L4) <code>&lt;T></code>: allows us to define a generic function that doesn&rsquo;t depend on a specific structure</li><li>the offset lets us to navigate from header to header (<code>offset = 0</code> for <em>ethHdr</em>)</li><li>(L7) We had to change how the structure length is calculated, using <code>size_of</code>, to make it work properly.</li></ul><p>Then the main code becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dst_addr {:mac} &#34;</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;received a packet&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Now that we have created the function that allows us to traverse the different headers, let&rsquo;s see how we can block or allow packets based on network headers.</p><hr><h2 class="relative group">Guided tour of the different headers<div id=guided-tour-of-the-different-headers class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#guided-tour-of-the-different-headers aria-label=Anchor>#</a></span></h2><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=headers src=https://blog.littlejo.link/assets/svg/xdp/packet-headers.svg></figure></p><h3 class="relative group">Level 1: Network access<div id=level-1-network-access class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-1-network-access aria-label=Anchor>#</a></span></h3><h4 class="relative group">What we can filter<div id=what-we-can-filter class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-we-can-filter aria-label=Anchor>#</a></span></h4><p>We already saw this for the first level: we can retrieve the source MAC address, the destination MAC address, and the EtherType. This allows us to filter based on the MAC address</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=ethhdr src=https://blog.littlejo.link/assets/svg/xdp/packet-ethhdr.svg></figure></p><p><a href=https://docs.rs/network-types/latest/network_types/eth/struct.EthHdr.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation ethhdr" src=https://blog.littlejo.link/assets/screenshot/xdp/ethhdr.webp></figure></a></p><p>So we&rsquo;ll use the function we created earlier, <code>ptr_at()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>To retrieve the MAC addresses and display them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>src_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>src_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;src: {:mac} =&gt; dst: {:mac}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>src_addr</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s test it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>And ping. Let&rsquo;s look at the result:</p><pre tabindex=0><code>[INFO  browser_xdp] src: de:ad:be:ef:00:10 =&gt; dst: de:ad:be:ef:00:01
[INFO  browser_xdp] src: de:ad:be:ef:00:10 =&gt; dst: de:ad:be:ef:00:01
</code></pre><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="namepaces with xdp program" src=https://blog.littlejo.link/assets/svg/xdp/namespaces-ping-mac.svg></figure></p><p>To write cleaner code, we can create a function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>display_ethhdr</span><span class=p>(</span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>XdpContext</span><span class=p>,</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>src_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>src_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethertype</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;EthHdr: src: {:mac} =&gt; dst: {:mac} ({})&#34;</span><span class=p>,</span><span class=w> </span><span class=n>src_addr</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>,</span><span class=w> </span><span class=n>ethertype</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">Let&rsquo;s filter<div id=lets-filter class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lets-filter aria-label=Anchor>#</a></span></h4><p>So, to filter a MAC address, we can do the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>mac</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mh>0xde</span><span class=p>,</span><span class=w> </span><span class=mh>0xad</span><span class=p>,</span><span class=w> </span><span class=mh>0xbe</span><span class=p>,</span><span class=w> </span><span class=mh>0xef</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x10</span><span class=p>];</span><span class=w> </span><span class=c1>//de:ad:be:ef:00:10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=n>mac</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>src_addr</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;drop&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_DROP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class="flex px-4 py-3 rounded-md
alert-info"><span class="pe-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg fill="currentColor" width="96" height="92.25" viewBox="0 0 24 23.0625" id="svg1"><path d="m24 0-1.40625.625-6.625 2.84375-7.625-2.875-.375-.125-.375.15625-7 3L0 3.875v19.1875l1.40625-.625 6.625-2.84375 7.625 2.875.375.125.375-.15625 7-3L24 19.1875zM9 2.96875l6 2.25v14.875l-6-2.25zm-2 .0625V17.875L2 20.03125V5.1875zm15 0V17.875l-5 2.15625V5.1875z" id="path1"/></svg>
</span></span><span class=dark:text-neutral-300>In a ‚Äúreal‚Äù project, we wouldn&rsquo;t hard-code this. We would create an eBPF map that we would fill in the user space with a list of MAC addresses to filter. We have already seen a similar case in the <a href=https://dev.to/littlejo/enhancing-your-aya-program-with-ebpf-maps-4hdj target=_blank>section dedicated to eBPF maps in the introduction</a>.</span></div><p>Let&rsquo;s test it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>Let&rsquo;s ping from lb: it no longer pings. Let&rsquo;s look at the result in Aya:</p><pre tabindex=0><code>[INFO  browser_xdp] drop
[INFO  browser_xdp] drop
</code></pre><p>The program correctly identifies the packet and stops it.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="namepaces with xdp program" src=https://blog.littlejo.link/assets/svg/xdp/namespaces-ping-mac-not.svg></figure></p><p>Let&rsquo;s ping from the <code>h2</code> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fish data-lang=fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>h2 ping <span class=na>-c</span> <span class=m>2</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span>
</span></span></code></pre></div><p>The ping goes through:</p><pre tabindex=0><code>[INFO  browser_xdp] received ethhdr packet src: de:ad:be:ef:00:02 =&gt; dst: de:ad:be:ef:00:01
[INFO  browser_xdp] received ethhdr packet src: de:ad:be:ef:00:02 =&gt; dst: de:ad:be:ef:00:01
</code></pre><p>To make it more like <code>xdp-filter</code>, we can create this function that allows us to distinguish whether we want to block the source or the destination:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>enum</span> <span class=nc>Mode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Src</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Dst</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>drop_mac</span><span class=p>(</span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=p>,</span><span class=w> </span><span class=n>mac</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>6</span><span class=p>],</span><span class=w> </span><span class=n>mode</span>: <span class=nc>Mode</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>mode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Src</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>src_addr</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Dst</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>mac</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>addr</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>In the main code, this gives us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>mac</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mh>0xde</span><span class=p>,</span><span class=w> </span><span class=mh>0xad</span><span class=p>,</span><span class=w> </span><span class=mh>0xbe</span><span class=p>,</span><span class=w> </span><span class=mh>0xef</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x10</span><span class=p>];</span><span class=w> </span><span class=c1>//de:ad:be:ef:00:10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>display_ethhdr</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>ethhdr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>drop_mac</span><span class=p>(</span><span class=n>ethhdr</span><span class=p>,</span><span class=w> </span><span class=n>mac</span><span class=p>,</span><span class=w> </span><span class=n>Mode</span>::<span class=n>Src</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_DROP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_DROP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">Level up<div id=level-up class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-up aria-label=Anchor>#</a></span></h4><p>The Ethertype determines the protocol of the packet in the upper layer.</p><p>To retrieve it, we can use the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ethertype</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=p>}</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>But there is a cleaner way with the <code>ether_type()</code> method, which checks whether the protocol number actually exists:
<a href=https://docs.rs/network-types/latest/network_types/eth/struct.EthHdr.html#method.ether_type target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation EtherType" src=https://blog.littlejo.link/assets/screenshot/xdp/ethhdr-ethertype.webp></figure></a></p><p>Instead of memorizing protocol numbers, the <code>network-types</code> crate simplifies things with the <code>EtherType</code> type:</p><p><a href=https://docs.rs/network-types/latest/network_types/eth/enum.EtherType.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation EtherType" src=https://blog.littlejo.link/assets/screenshot/xdp/ethertype.webp></figure></a></p><p>This allows us to filter in the following way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=p>()</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>EtherType</span>::<span class=n>Ipv4</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Flows other than IPv4 (e.g., IPv6, Arp) pass through directly and are no longer analyzed.</p><h3 class="relative group">Level 2: Internet<div id=level-2-internet class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-2-internet aria-label=Anchor>#</a></span></h3><h4 class="relative group">What we can filter<div id=what-we-can-filter-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-we-can-filter-1 aria-label=Anchor>#</a></span></h4><p>So let&rsquo;s assume that we only want to analyze IPv4 traffic.</p><p>As with Ethernet, let&rsquo;s look at what data we can retrieve with the IPv4 header:<figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=ethhdr src=https://blog.littlejo.link/assets/svg/xdp/packet-iphdr.svg></figure></p><p>For clarity, the header is shown on several lines.
There is significantly more information to retrieve. The ones we will use for this article are:</p><ul><li><code>PROTOCOL</code>: the upper-level protocol (TCP or UDP, for example)</li><li><code>SOURCE ADDRESS</code>: the source IP address</li><li><code>DESTINATION ADDRESS</code>: the destination IP address</li></ul><div class="flex px-4 py-3 rounded-md
alert-info"><span class="pe-3 flex items-center
alert-icon-info"><span class="relative block icon"><svg viewBox="0 0 16 16" fill="currentColor"><path d="M.001 5.378S-.188 1.177 4.145.305c4.333-.872 6.963 1.506 7.35 3.171C11.882 5.141 12.07 5.994 11.882 6.647 11.65 6.964 11.727 7.202 12.191 7.995 12.655 8.788 13.584 9.66 12.268 9.818 11.417 9.977 11.959 10.531 11.959 10.531S12.191 11.007 11.495 11.086c0 0 .464.872.077.872C11.185 11.958 11.108 12.117 11.03 12.434c-.077.317.077 2.061-2.631 1.03C7.78 13.147 7.507 14.441 7.161 15.208 6.953 15.669 6.73 16.298 5.691 15.842c-.927-.407-2.995-1.378-3.771-2.705-.424-.727.693-1.778.151-3.205-.542-1.427-.712-.987-1.254-1.779C.276 7.36.079 6.329.001 5.378z"/></svg>
</span></span><span class=dark:text-neutral-300>If you find the IPv4 header complex, this is one of the reasons IPv6 was created: its <a href=https://en.wikipedia.org/wiki/IPv6_packet#Fixed_header target=_blank>header</a> is a little simpler,
making packet processing easier.</span></div><p>In Rust, we can retrieve these headers:
<a href=https://docs.rs/network-types/latest/network_types/ip/struct.Ipv4Hdr.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Ipv4Hdr Documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/ipv4hdr.webp></figure></a></p><p>To retrieve the IPv4 headers, simply shift the pointer to the length of the Ethernet header structure using the function we created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>ipv4hdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>In the same way as for the lower layer, we can create a function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>display_iphdr</span><span class=p>(</span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>XdpContext</span><span class=p>,</span><span class=w> </span><span class=n>iphdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dst_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>iphdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>src_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>iphdr</span><span class=p>).</span><span class=n>src_addr</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>proto</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>iphdr</span><span class=p>).</span><span class=n>proto</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Ipv4Hdr: src: {:i} =&gt; dst: {:i} ({})&#34;</span><span class=p>,</span><span class=w> </span><span class=n>src_addr</span><span class=p>,</span><span class=w> </span><span class=n>dst_addr</span><span class=p>,</span><span class=w> </span><span class=n>proto</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u8</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="pe-3 flex items-center
alert-icon-tip"><span class="relative block icon"><svg width="1114.9938" height="737.55341" viewBox="0 0 1114.9938 737.55341" style="clip-rule:evenodd;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421" id="svg47080"><g id="layer8" transform="translate(-424.6391,-562.834)"/><g id="layer7" transform="translate(-424.6391,-562.834)"><g id="layer3" style="display:inline"><g id="Layer-1" style="clip-rule:evenodd;display:inline;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421" transform="translate(400,525)"><g transform="translate(597.344,637.02)" id="g47033" style="fill:#000"><path d="m0-279.559c-121.238.0-231.39 14.576-312.939 38.329V-38.329C-231.39-14.575-121.238.0.0.0 138.76.0 262.987-19.092 346.431-49.186V-230.37C262.987-260.465 138.76-279.559.0-279.559" style="fill:#000;fill-rule:nonzero" id="path47031"/></g><g transform="translate(1068.75,575.642)" id="g47037" style="fill:#000"><path d="m0-53.32-14.211-29.441c.073-1.118.131-2.237.131-3.36.0-33.375-34.706-64.135-93.097-88.762V2.643c27.245-11.492 49.348-24.317 65.156-38.125-4.652 18.707-20.564 56.553-33.25 83.168-20.85 38.066-28.4 71.203-27.432 72.844.617 1.033 7.73-9.94 18.219-27.721C-60.074 58.028-13.82-8.373-4.575-25.287 5.897-44.461.0-53.32.0-53.32" style="fill:#000;fill-rule:nonzero" id="path47035"/></g><g transform="translate(149.064,591.421)" id="g47041" style="fill:#000"><path d="m0-99.954c0 6.428 1.293 12.76 3.788 18.969l-8.511 15.15s-6.818 8.846 5.188 27.508C11.055-21.872 64.1 42.54 92.097 76.271c12.026 17.293 20.179 27.945 20.893 26.916 1.124-1.633-7.476-34.1-31.359-71.141-11.144-19.895-24.454-46.252-32.442-65.721 22.303 14.116 51.483 26.92 86.152 37.94V-204.17C51.797-177.622.0-140.737.0-99.954" style="fill:#000;fill-rule:nonzero" id="path47039"/></g><g transform="translate(450.328,483.629)" id="g47049"><path d="m0 167.33c-1.664-1.42-2.536-2.262-2.536-2.262l142.542-11.677C23.733.0-69.418 122.193-79.333 135.855v31.475z" style="fill-rule:nonzero" id="path47047"/></g><g transform="translate(747.12,477.333)" id="g47053"><path d="m0 171.974c1.663-1.42 2.536-2.264 2.536-2.264l-136.984-10.023C-18.12.0 69.421 126.835 79.335 140.497v31.477z" style="fill-rule:nonzero" id="path47051"/></g></g></g><g id="layer2" style="display:inline"><g transform="translate(1533.408,803.891)" id="g47045" style="clip-rule:evenodd;display:inline;fill:#currentcolor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 240.343-93.415-68.811c-.88-3.064-1.756-6.127-2.662-9.162l30.683-44.451c3.13-4.522 3.765-10.398 1.731-15.555-2.037-5.13-6.491-8.81-11.763-9.71l-51.884-8.805c-2.008-4.102-4.116-8.142-6.23-12.15l21.797-49.903c2.243-5.087 1.769-10.995-1.203-15.608-2.961-4.636-7.99-7.344-13.349-7.133l-52.656 1.913c-2.727-3.55-5.496-7.068-8.321-10.521l12.1-53.49c1.225-5.433-.322-11.118-4.103-15.064-3.762-3.932-9.229-5.559-14.426-4.283l-51.289 12.608c-3.321-2.935-6.698-5.833-10.114-8.673l1.848-54.914c.198-5.559-2.393-10.842-6.844-13.925-4.446-3.104-10.093-3.573-14.956-1.266l-47.847 22.747c-3.854-2.21-7.728-4.4-11.644-6.517l-8.455-54.115c-.857-5.483-4.385-10.139-9.326-12.266-4.923-2.137-10.568-1.447-14.891 1.808l-42.659 32.007c-4.2-1.395-8.419-2.732-12.692-4.011l-18.386-51.316c-1.87-5.229-6.181-9.071-11.438-10.151-5.239-1.072-10.63.742-14.263 4.802l-35.906 40.171c-4.343-.5-8.686-.956-13.043-1.331l-27.724-46.713c-2.81-4.732-7.77-7.612-13.116-7.612-5.334.0-10.304 2.88-13.09 7.612l-27.733 46.713c-4.358.375-8.722.831-13.056 1.331l-35.91-40.171c-3.636-4.06-9.047-5.874-14.268-4.802-5.255 1.092-9.573 4.922-11.433 10.151l-18.402 51.316c-4.26 1.279-8.481 2.627-12.691 4.011l-42.644-32.007c-4.336-3.266-9.98-3.955-14.916-1.808-4.919 2.127-8.461 6.783-9.313 12.266l-8.461 54.115c-3.914 2.117-7.789 4.294-11.653 6.517l-47.842-22.747c-4.858-2.316-10.529-1.838-14.954 1.266-4.445 3.083-7.042 8.366-6.84 13.925l1.835 54.914c-3.405 2.84-6.774 5.738-10.112 8.673l-51.279-12.608c-5.21-1.265-10.67.351-14.441 4.283-3.795 3.946-5.331 9.631-4.113 15.064l12.079 53.49c-2.802 3.467-5.575 6.971-8.293 10.521l-52.655-1.913c-5.314-.157-10.386 2.497-13.356 7.133-2.973 4.613-3.423 10.521-1.213 15.608l21.816 49.903c-2.119 4.008-4.224 8.048-6.249 12.15l-51.887 8.805c-5.27.888-9.71 4.566-11.76 9.71-2.04 5.157-1.37 11.033 1.73 15.555l30.7 44.451c-.24.784-.46 1.577-.7 2.364l-86.77 92.17s-13.29 10.423 6.07 34.916c17.07 21.605 104.724 107.252 151.018 152.123 19.554 22.779 32.948 36.886 34.349 35.666 2.208-1.94-9.387-43.385-47.902-92.012-29.685-43.629-68.215-110.733-59.175-118.467.0.0 10.27-13.045 30.893-22.435.753.603-.781-.598.0.0.0.0 435.152 200.732 838.797 3.396 46.108-8.273 74.023 16.43 74.023 16.43 9.628 5.58-15.301 74.578-35.798 120.254-27.881 51.863-31.97 92.332-29.604 93.736 1.491.889 11.634-14.545 26.104-39.109C-79.843 391.654-12.354 296.816.0 273.782c14.006-26.119.0-33.439.0-33.439" style="fill:currentColor;fill-rule:nonzero" id="path47043"/></g></g><g id="layer5"><ellipse style="fill:#000;stroke:#000;stroke-width:1.77505" id="path319" cx="984.21155" cy="974.09283" rx="228.89882" ry="131.31676"/><ellipse style="fill:#000;fill-opacity:0;stroke:#000;stroke-width:38.6157;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path423" cx="982.29688" cy="969.62152" rx="306.21515" ry="161.31026"/><ellipse style="clip-rule:evenodd;fill:#000;fill-opacity:0;fill-rule:evenodd;stroke:#000;stroke-width:39.8062;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path423-3" cx="978.92542" cy="932.41345" rx="396.3967" ry="212.5099"/></g><g id="layer6" style="display:inline"><ellipse style="clip-rule:evenodd;fill:currentColor;fill-opacity:1;fill-rule:evenodd;stroke:#000;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path977" cx="971.17297" cy="350.80408" rx="241.7849" ry="72.576942" transform="rotate(22.166895)"/><ellipse style="clip-rule:evenodd;fill:currentColor;fill-opacity:1;fill-rule:evenodd;stroke:#000;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="ellipse2369" cx="-859.38287" cy="1097.5022" rx="241.7849" ry="72.576942" transform="matrix(-0.92608874,0.37730576,0.37730576,0.92608874,0,0)"/><g id="g3771" transform="translate(400,525)"><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2509-3" d="m176.76083 102.59373c10.48622 2.15024 20.88 4.71573 31.29237 7.1917 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.23611-12.08759-3.35416-10.1347-2.628217-20.21057-5.478978-30.40597-7.861622l-12.16816 8.454102z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2511-6" d="m402.92414 156.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path2513-7" d="m535.85588 225.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2509" d="m582.76083 621.59374c10.48622 2.15023 20.88 4.71572 31.29237 7.19169 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.2361-12.08759-3.35416-10.1347-2.62821-20.21057-5.47897-30.40597-7.86162l-12.16816 8.45411z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2511" d="m804.92414 673.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path2513" d="m937.85588 742.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/><g id="g3789" transform="matrix(-1,0,0,1,1567.5877,525)"><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3783" d="m176.76083 102.59373c10.48622 2.15024 20.88 4.71573 31.29237 7.1917 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.85267-4.03736-1.0882-8.05839-2.23611-12.08759-3.35416-10.1347-2.628217-20.21057-5.478978-30.40597-7.861622l-12.16816 8.454102z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3785" d="m402.92414 156.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="clip-rule:evenodd;fill:#5fa8ff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:5;stroke-linejoin:round;stroke-miterlimit:1.41421;stroke-dasharray:none" id="path3787" d="m535.85588 225.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g><g id="g3797" transform="matrix(-1,0,0,1,1567.5877,525)" style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-opacity:1"><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3791" d="m182.76083 96.593738c10.48622 2.150236 20.88 4.715722 31.29237 7.191692 34.76986 8.74786 69.56095 17.4098 104.39745 25.88951 40.7881 10.26698 81.43657 21.86214 119.9943 38.88561 7.33104 3.23669 14.48835 6.8534 21.73252 10.2801 23.9166 12.59397 47.69564 26.35611 67.64167 44.83632 10.82979 10.03391 12.49148 13.04437 21.44219 24.43313 2.56057 3.86379 5.12113 7.72758 7.6817 11.59137l11.38391-6.67967v0c-2.64822-3.85015-5.29643-7.7003-7.94465-11.55045-9.05404-11.36514-10.86919-14.54081-21.80757-24.52129-20.23559-18.46352-44.37629-32.01151-68.47461-44.66858-7.26016-3.44203-14.42489-7.09299-21.78047-10.32608-38.60832-16.97002-79.32036-28.38516-120.01428-39.08049-20.22672-5.11275-40.39438-10.42431-60.58717-15.66683-13.42874-3.48642-17.26062-4.33929-30.29564-7.852665-4.03736-1.088204-8.05839-2.236108-12.08759-3.354163-10.1347-2.628215-20.21057-5.478976-30.40597-7.86162l-12.16816 8.454106z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3793" d="m404.92414 148.84453c-.62264.10322-1.2412.23512-1.86793.30966-4.12254.49028-6.92714.58188-11.31546.87912-10.01805.67856-16.42671 1.20293-26.78634 1.65072-5.63446.24354-11.27372.35937-16.91059.53906-20.57197.48125-41.16897-.46479-61.43469-4.16984-8.25956-1.51004-12.4696-2.69037-20.40799-4.68128-7.73385-2.15623-15.26711-5.01655-22.47103-8.56318-4.39711-2.16477-6.81702-3.69036-10.95152-6.13145l-11.94579 7.75255v0c3.88967 2.22712 7.1309 4.16019 11.19427 6.1426 7.33338 3.57776 14.99704 6.45081 22.86534 8.60951 11.33956 2.68762 22.69088 5.16399 34.27986 6.56388 16.09227 1.94386 32.32547 2.1992 48.51308 2.04624 5.57758-.12559 11.15625-.20978 16.73274-.37677 8.74159-.26175 17.23884-.69853 25.95641-1.03713 3.62279-.14071 7.25234-.13715 10.87018-.37312.60919-.0397 1.2106-.15879 1.8159-.23818l11.86356-8.92239z"/><path style="fill:#656565;fill-opacity:1;stroke:#656565;stroke-width:5;stroke-miterlimit:1.41421;stroke-dasharray:none;stroke-opacity:1" id="path3795" d="m537.85588 217.31821c-4.25747.27683-5.95399.4571-10.95639.25275-7.84256-.32037-18.07803-1.4359-25.6643-2.3401-15.77669-1.88041-17.6995-2.32505-33.64103-4.79522-12.9308-2.44415-20.64218-3.71728-33.3647-6.83915-5.15526-1.265-10.24798-2.77243-15.37198-4.15865l-10.66401 7.32723v0c5.16236 1.38368 10.29378 2.88849 15.4871 4.15105 12.19482 2.9647 21.11663 4.49934 33.47846 6.85395 16.62334 2.67926 16.97997 2.84483 33.34239 5.06858 6.51039.88481 18.05956 2.3889 25.01175 2.96755 5.33581.44411 6.09594.36283 10.42132.29524l11.92139-8.78323z"/></g></g><g id="layer4"><g transform="translate(1366.094,1336.034)" id="g47057" style="clip-rule:evenodd;display:inline;fill:#333;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-314.014s-15.576 62.041-112.453 127.238l-27.166 6.367s-87.881-160.259-212.383 20.334c0 0 38.802-22.591 142.822 4.92.0.0-47.85 73.239-144.242 70.989.0.0 92.373 110.82 232.94-49.252.0.0 148.595-57.463 160.646-180.596z" style="fill:#333;fill-rule:nonzero" id="path47055"/></g><g transform="translate(841.397,1212.635)" id="g47077" style="clip-rule:evenodd;display:inline;fill:#333;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="M0-25.102C91.833-36.676 144.904-37.754 144.904-37.754 22.037-199.838-77.661-53.098-77.661-53.098c-24.982-8.932-50.453-43.613-69.477-75.59l-76.237-22.58C-135.502-2.127-70.08.146-70.08.146 66.134 174.736 130.663 34.441 130.663 34.441 54.195 25.759.0-25.102.0-25.102" style="fill:#333;fill-rule:nonzero" id="path47075"/></g></g><g id="layer1" style="display:inline"><g transform="translate(1077.392,1034.61)" id="g47061" style="clip-rule:evenodd;display:inline;fill:currentColor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-92.063s43.486-47.615 86.974.0c0 0 34.17 63.492.0 95.234.0.0-55.912 44.444-86.974.0.0.0-37.275-34.921.0-95.234" style="fill:currentColor;fill-rule:nonzero" id="path47059"/></g><g transform="translate(1127.738,960.209)" id="g47065" style="clip-rule:evenodd;display:inline;fill:#000;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 .002c0 18.541-10.93 33.572-24.408 33.572-13.477.0-24.406-15.031-24.406-33.572.0-18.541 10.929-33.574 24.406-33.574C-10.93-33.572.0-18.539.0.002" style="fill:#000;fill-rule:nonzero" id="path47063"/></g><g transform="translate(883.3,1027.984)" id="g47069" style="clip-rule:evenodd;display:inline;fill:currentColor;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0-98.439s74.596-33.028 94.956 40.691c0 0 21.327 85.926-61.259 90.776.0.0-105.31-20.283-33.697-131.467" style="fill:currentColor;fill-rule:nonzero" id="path47067"/></g><g transform="translate(920.766,961.428)" id="g47073" style="clip-rule:evenodd;display:inline;fill:#000;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path d="m0 0c0 19.119-11.27 34.627-25.173 34.627-13.898.0-25.171-15.508-25.171-34.627.0-19.124 11.273-34.627 25.171-34.627C-11.27-34.627.0-19.124.0.0" style="fill:#000;fill-rule:nonzero" id="path47071"/></g></g></g></svg>
</span></span><span class=dark:text-neutral-300>As with MAC addresses, the <code>info!</code> macro simplifies things by converting a 4-byte array into IPv4 notation with <code>:i</code>.</span></div><p>Let&rsquo;s test the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>network_types</span>::<span class=p>{</span><span class=n>eth</span>::<span class=p>{</span><span class=n>EthHdr</span><span class=p>,</span><span class=n>EtherType</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ip</span>::<span class=n>Ipv4Hdr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=p>()</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>EtherType</span>::<span class=n>Ipv4</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ipv4hdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>mac</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mh>0xde</span><span class=p>,</span><span class=w> </span><span class=mh>0xad</span><span class=p>,</span><span class=w> </span><span class=mh>0xbe</span><span class=p>,</span><span class=w> </span><span class=mh>0xef</span><span class=p>,</span><span class=w> </span><span class=mh>0x00</span><span class=p>,</span><span class=w> </span><span class=mh>0x10</span><span class=p>];</span><span class=w> </span><span class=c1>//de:ad:be:ef:00:10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>//display_ethhdr(&amp;ctx, ethhdr);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>display_iphdr</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>ipv4hdr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s ping again:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>lb ping <span class=na>-c</span> <span class=m>2</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span>
</span></span></code></pre></div><p>On the <code>cargo run</code> side, this gives:</p><pre tabindex=0><code>[INFO  browser_xdp] Ipv4Hdr: src: 10.0.0.10 =&gt; dst: 10.0.0.1 (1)
[INFO  browser_xdp] Ipv4Hdr: src: 10.0.0.10 =&gt; dst: 10.0.0.1 (1)
</code></pre><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="namepaces with xdp program" src=https://blog.littlejo.link/assets/svg/xdp/namespaces-xdp-ping.svg></figure></p><p>In the same way as with the Mac address, to prevent the lb IP, we can use this function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>drop_ip</span><span class=p>(</span><span class=n>iphdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=p>,</span><span class=w> </span><span class=n>ip</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>4</span><span class=p>],</span><span class=w> </span><span class=n>mode</span>: <span class=nc>Mode</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>mode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Src</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>iphdr</span><span class=p>).</span><span class=n>src_addr</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Dst</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>iphdr</span><span class=p>).</span><span class=n>dst_addr</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ip</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>addr</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The main code then gives:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=p>()</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>EtherType</span>::<span class=n>Ipv4</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ipv4hdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>display_iphdr</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>ipv4hdr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>drop_ip</span><span class=p>(</span><span class=n>ipv4hdr</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>],</span><span class=w> </span><span class=n>Mode</span>::<span class=n>Src</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_DROP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The ping no longer works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>lb ping <span class=na>-c</span> <span class=m>2</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span>
</span></span></code></pre></div><pre tabindex=0><code>[INFO  browser_xdp] Ipv4Hdr: src: 10.0.0.10 =&gt; dst: 10.0.0.1 (1)
[INFO  browser_xdp] Ipv4Hdr: src: 10.0.0.10 =&gt; dst: 10.0.0.1 (1)
</code></pre><p>The program correctly identifies the packet and stops it.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="namepaces xdp" src=https://blog.littlejo.link/assets/svg/xdp/namespaces-xdp-ping-not.svg></figure></p><h4 class="relative group">Level up<div id=level-up-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-up-1 aria-label=Anchor>#</a></span></h4><p>To go to the next level, you need to know which protocol you want to look at. To do this, use the <code>proto</code> option. It is of type <code>IPProto</code>, which is an enumeration:</p><p><a href=https://docs.rs/network-types/latest/network_types/ip/enum.IpProto.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Ipv4Hdr Documentation" src=https://blog.littlejo.link/assets/screenshot/xdp/ipproto.webp></figure></a>We will look at UDP at the end of the article. The principle is the same as for <em>Ethertype</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ipv4hdr</span><span class=p>).</span><span class=n>proto</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>IpProto</span>::<span class=n>Udp</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>It is easy to filter if you want to block certain protocols.</p><h3 class="relative group">Level 3: Transport<div id=level-3-transport class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-3-transport aria-label=Anchor>#</a></span></h3><h4 class="relative group">What we can filter<div id=what-we-can-filter-2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-we-can-filter-2 aria-label=Anchor>#</a></span></h4><p>For UDP, we can retrieve the header in this way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>udphdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>UdpHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Ipv4Hdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Now let&rsquo;s look at the UDP segment header:</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=udphdr src=https://blog.littlejo.link/assets/svg/xdp/packet-udphdr.svg></figure></p><p>The most interesting part to filter are the ports.</p><p>In Rust:
<a href=https://docs.rs/network-types/latest/network_types/udp/struct.UdpHdr.html target=_blank><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation UdpHdr" src=https://blog.littlejo.link/assets/screenshot/xdp/udphdr.webp></figure></a></p><p>Ports are not integers but arrays of 2 bytes. This is not practical. Fortunately, there are the following methods:</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation UdpHdr src port" src=https://blog.littlejo.link/assets/screenshot/xdp/udphdr-src.webp></figure><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Documentation UdpHdr dst port" src=https://blog.littlejo.link/assets/screenshot/xdp/udphdr-dst.webp></figure></p><p>We can filter at the UDP port level:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=cp>#[inline(always)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>drop_udp_port</span><span class=p>(</span><span class=n>udphdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>UdpHdr</span><span class=p>,</span><span class=w> </span><span class=n>port</span>: <span class=kt>u16</span><span class=p>,</span><span class=w> </span><span class=n>mode</span>: <span class=nc>Mode</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>packet_port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>mode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Src</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>udphdr</span><span class=p>).</span><span class=n>src_port</span><span class=p>()},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Mode</span>::<span class=n>Dst</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{(</span><span class=o>*</span><span class=n>udphdr</span><span class=p>).</span><span class=n>dst_port</span><span class=p>()},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>port</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>packet_port</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s test the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>network_types</span>::<span class=p>{</span><span class=n>eth</span>::<span class=p>{</span><span class=n>EthHdr</span><span class=p>,</span><span class=n>EtherType</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ip</span>::<span class=p>{</span><span class=n>Ipv4Hdr</span><span class=p>,</span><span class=n>IpProto</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>udp</span>::<span class=n>UdpHdr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>try_browser_xdp</span><span class=p>(</span><span class=n>ctx</span>: <span class=nc>XdpContext</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ethhdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>EthHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ethhdr</span><span class=p>).</span><span class=n>ether_type</span><span class=p>()</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>EtherType</span>::<span class=n>Ipv4</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ipv4hdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>Ipv4Hdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>ipv4hdr</span><span class=p>).</span><span class=n>proto</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>IpProto</span>::<span class=n>Udp</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>udphdr</span>: <span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>UdpHdr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr_at</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>EthHdr</span>::<span class=no>LEN</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Ipv4Hdr</span>::<span class=no>LEN</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>display_udphdr</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>udphdr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>drop_udp_port</span><span class=p>(</span><span class=n>udphdr</span><span class=p>,</span><span class=w> </span><span class=mi>8888</span><span class=p>,</span><span class=w> </span><span class=n>Mode</span>::<span class=n>Dst</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_DROP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>xdp_action</span>::<span class=no>XDP_PASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s install the XDP program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>cargo</span> run
</span></span></code></pre></div><p>Let&rsquo;s create a UDP server with netcat:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>nc</span> <span class=na>-u</span> <span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span> <span class=na>-l</span> <span class=m>8000</span>
</span></span></code></pre></div><p>Now let&rsquo;s create a UDP client:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>lb netcat <span class=na>-u</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span> <span class=m>8000</span>
</span></span><span class=line><span class=cl><span class=nf>coucou</span>
</span></span></code></pre></div><p>This command opens a UDP client and sends the message <code>coucou</code>.</p><p>On the UDP server side, we can clearly see:</p><pre tabindex=0><code>coucou
</code></pre><p>But above all, we can clearly see on the <code>cargo run</code> side:</p><pre tabindex=0><code>[INFO  browser_xdp] UdpHdr: src: 44024 =&gt; dst: 8000
</code></pre><p>Now let&rsquo;s test with a UDP server on port 8888:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>nc</span> <span class=na>-u</span> <span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span> <span class=na>-l</span> <span class=m>8888</span>
</span></span></code></pre></div><p>Now let&rsquo;s create a UDP client:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Fish data-lang=Fish><span class=line><span class=cl><span class=nf>ip</span> netns <span class=nb>exec </span>lb netcat <span class=na>-u</span> <span class=m>10</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>1</span> <span class=m>8888</span>
</span></span><span class=line><span class=cl><span class=nf>coucou</span>
</span></span></code></pre></div><p>Nothing is displayed on the server, which is normal because the XDP program has blocked it:</p><pre tabindex=0><code>[INFO  browser_xdp] UdpHdr: src: 39540 =&gt; dst: 8888
</code></pre><div class="flex px-4 py-3 rounded-md
alert-tip"><span class="pe-3 flex items-center
alert-icon-tip"><span class="relative block icon"><!doctype html><svg height="800" width="800" id="_x32_" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><style>.st0{fill:currentColor}</style><g><path class="st0" d="M485.235 281.91l-44.273-25.356-65.345 8.26c-1.168-4.886-2.55-9.608-4.173-14.099l46.634-18.049 27.349-47.596-2.954-23.279c18.874-15.396 31.677-45.767 16.762-78.388-18.024-39.422-54.964-47.27-54.964-47.27l2.07 70.755-56.364-28.259c-5.169 72.541 40.787 95.467 69.029 93.252l1.031 8.098-18.917 32.912-40.512 15.688c-13.516-20.728-36.811-43.303-38.589-58.287 5.144-4.336 8.407-10.82 8.407-18.075.0-13.051-10.578-23.631-23.63-23.631s-23.64 10.58-23.64 23.631c0 6.475 2.611 12.34 6.818 16.607-7.007 10.501-6.414 17.723-33.978 17.723-27.555.0-26.97-7.222-33.977-17.723 4.216-4.267 6.826-10.132 6.826-16.607.0-13.051-10.588-23.631-23.648-23.631-13.052.0-23.622 10.58-23.622 23.631.0 7.256 3.263 13.739 8.406 18.075-1.777 14.984-25.073 37.558-38.588 58.287l-40.521-15.688-18.9-32.912 1.022-8.098c28.242 2.215 74.198-20.711 69.021-93.252l-56.364 28.259 2.078-70.755s-36.948 7.849-54.963 47.27c-14.924 32.62-2.113 62.992 16.752 78.388l-2.954 23.279 27.348 47.596 46.635 18.049c-1.606 4.491-2.998 9.213-4.174 14.099l-65.336-8.26L26.756 281.91.0 327.935l15.353 10.158 28.671-37.773 32.088-18.376 56.596 7.162c-.293 4.259-.404 8.518-.301 12.786l-40.71 13.567L52.216 362.84l-6.414 60.279 18.195 2.868 11.42-52.628 30.672-36.811 29.478-9.832c2.216 9.223 5.634 17.929 10.45 25.64l-27.624 19.174-11.867 51.546 15.903 52.791 17.774-4.808-8.569-49.176 9.247-36.064 20.574-14.28c34.467 33.874 81.737 33.643 94.539 33.643 12.812.0 60.073.231 94.549-33.643l20.574 14.28 9.239 36.064-8.56 49.176 17.774 4.808 15.903-52.791-11.876-51.546-27.632-19.174c4.826-7.711 8.244-16.418 10.458-25.64l29.479 9.832 30.68 36.811 11.412 52.628 18.195-2.868-6.414-60.279-39.482-47.381-40.71-13.567c.112-4.267-.009-8.526-.292-12.786l56.595-7.162 32.081 18.376 28.67 37.773L512 327.935 485.235 281.91z"/></g></svg>
</span></span><span class=dark:text-neutral-300>The functions <code>drop_mac()</code>, <code>drop_ip()</code>, and <code>drop_udp_port()</code> are very similar, and it is entirely possible in Rust to make them generic so that there is only one. The same applies to <code>display_ethdr()</code>, <code>display_iphdr()</code>, and <code>display_udphdr()</code>. You can see the more generic code in the crate dedicated to the blog <a href=https://github.com/littlejo/blog-xdp/blob/main/src/log.rs target=_blank>here</a> and <a href=https://github.com/littlejo/blog-xdp/blob/main/src/action.rs target=_blank>there</a>.</span></div><h3 class="relative group">Level 4: Application<div id=level-4-application class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#level-4-application aria-label=Anchor>#</a></span></h3><p>The crate <a href=https://docs.rs/network-types/latest/network_types/index.html target=_blank>network-types</a> does not help retrieve application protocol headers. By knowing the port from the previous level, you can easily filter the application. If you filter port 53, you will filter DNS, for example. But if you want to filter a specific request, that&rsquo;s another matter.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="curl command to retrieve http headers" src=https://blog.littlejo.link/assets/screenshot/xdp/layer-4.webp></figure></p><p>It is possible to go higher. But application headers can be:</p><ul><li>too large for the stack (limited to 512 bytes), requiring the use of eBPF maps;</li><li>encrypted, as with HTTPS or SSH, making analysis impossible with XDP.</li></ul><hr><p>This episode is now over! We have seen the basics of creating a firewall like <code>xdp-filter</code>.</p><p>However, we haven&rsquo;t seen how to make it a little smarter, for example by avoiding DDoS attacks.</p><p>That&rsquo;s good timing! In the next episode, we will create an XDP program that will mitigate denial-of-service attacks.</p></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">Getting Started with XDP in Aya -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/intro/>Part 1:
XDP: The Ultra-Fast Firewall Inside Linux</a></div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">Part 2:
This Article</div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/example-2/>Part 3:
Let's Mitigate DDoS Attacks with XDP</a></div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/en/ebpf-another-type/xdp/example-3-tr/>Part 4:
Let's Create a Little Load Balancer with XDP</a></div></details><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/&amp;title=Let%27s%20Build%20a%20Tiny%20Firewall%20with%20XDP" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://bsky.app/intent/compose?text=Let%27s%20Build%20a%20Tiny%20Firewall%20with%20XDP+https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/" title="Post on Bluesky" aria-label="Post on Bluesky"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://s2f.kytta.dev/?text=Let%27s%20Build%20a%20Tiny%20Firewall%20with%20XDP%20https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/" title="Share via Mastodon" aria-label="Share via Mastodon"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://blog.littlejo.link/en/ebpf-another-type/xdp/example-1/&amp;subject=Let%27s%20Build%20a%20Tiny%20Firewall%20with%20XDP" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_ebpf-another-type/xdp/example-1/index.md data-oid-likes=likes_ebpf-another-type/xdp/example-1/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/en/ebpf-another-type/xdp/intro/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;XDP: The Ultra-Fast Firewall Inside Linux
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-10-16T12:48:45+02:00>16 October 2025</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/en/ebpf-another-type/xdp/example-2/><span class=leading-6>Let's Mitigate DDoS Attacks with XDP&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-11-24T10:38:22+01:00>24 November 2025</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-24 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/en/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Joseph Ligier</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom):not(a > img)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://blog.littlejo.link/en/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>